<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=62035&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="//localhost:62035/docs/scenarios/">
<link rel="alternate" type="application/rss&#43;xml" href="//localhost:62035/docs/scenarios/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Scenarios | Krkn</title>
<meta name="description" content="Krkn Chaos Tool">
<meta property="og:url" content="//localhost:62035/docs/scenarios/">
  <meta property="og:site_name" content="Krkn">
  <meta property="og:title" content="Scenarios">
  <meta property="og:description" content="Supported chaos scenarios Scenario Description Pod failures Injects pod failures Container failures Injects container failures based on the provided kill signal Node failures Injects node failure through OpenShift/Kubernetes, cloud API’s zone outages Creates zone outage to observe the impact on the cluster, applications time skew Skews the time and date Node cpu hog Hogs CPU on the targeted nodes Node memory hog Hogs memory on the targeted nodes Node IO hog Hogs io on the targeted nodes Service Disruption Deleting all objects within a namespace Application outages Isolates application Ingress/Egress traffic to observe the impact on dependent applications and recovery/initialization timing Power Outages Shuts down the cluster for the specified duration and turns it back on to check the cluster health PVC disk fill Fills up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it Network Chaos Introduces network latency, packet loss, bandwidth restriction in the egress traffic of a Node’s interface using tc and Netem Pod Network Chaos Introduces network chaos at pod level Service Hijacking Hijacks a service http traffic to simulate custom HTTP responses ">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Scenarios">
  <meta itemprop="description" content="Supported chaos scenarios Scenario Description Pod failures Injects pod failures Container failures Injects container failures based on the provided kill signal Node failures Injects node failure through OpenShift/Kubernetes, cloud API’s zone outages Creates zone outage to observe the impact on the cluster, applications time skew Skews the time and date Node cpu hog Hogs CPU on the targeted nodes Node memory hog Hogs memory on the targeted nodes Node IO hog Hogs io on the targeted nodes Service Disruption Deleting all objects within a namespace Application outages Isolates application Ingress/Egress traffic to observe the impact on dependent applications and recovery/initialization timing Power Outages Shuts down the cluster for the specified duration and turns it back on to check the cluster health PVC disk fill Fills up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it Network Chaos Introduces network latency, packet loss, bandwidth restriction in the egress traffic of a Node’s interface using tc and Netem Pod Network Chaos Introduces network chaos at pod level Service Hijacking Hijacks a service http traffic to simulate custom HTTP responses ">
  <meta itemprop="datePublished" content="2017-01-04T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-09-11T17:37:33-04:00">
  <meta itemprop="wordCount" content="185">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Scenarios">
  <meta name="twitter:description" content="Supported chaos scenarios Scenario Description Pod failures Injects pod failures Container failures Injects container failures based on the provided kill signal Node failures Injects node failure through OpenShift/Kubernetes, cloud API’s zone outages Creates zone outage to observe the impact on the cluster, applications time skew Skews the time and date Node cpu hog Hogs CPU on the targeted nodes Node memory hog Hogs memory on the targeted nodes Node IO hog Hogs io on the targeted nodes Service Disruption Deleting all objects within a namespace Application outages Isolates application Ingress/Egress traffic to observe the impact on dependent applications and recovery/initialization timing Power Outages Shuts down the cluster for the specified duration and turns it back on to check the cluster health PVC disk fill Fills up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it Network Chaos Introduces network latency, packet loss, bandwidth restriction in the egress traffic of a Node’s interface using tc and Netem Pod Network Chaos Introduces network chaos at pod level Service Hijacking Hijacks a service http traffic to simulate custom HTTP responses ">
<link href="/scss/main.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250"><defs><style>.cls-1{fill:none}.cls-1,.cls-2,.cls-3,.cls-4,.cls-5,.cls-6,.cls-7,.cls-8{stroke-width:0}.cls-3{fill:#0e58a0}.cls-4{fill:#0d58a1}.cls-5{fill:#102d4f}.cls-6{fill:#9b1c1f}.cls-7{fill:#fff}.cls-8{fill:#ec1c24}</style></defs><path class="cls-3" d="M163.75 116.65l-1.36.66c.57-.17 1.15-.32 1.73-.48l-.37-.18z"/><path class="cls-3" d="M133 133.87h0q.72.61.0.0z"/><polygon class="cls-8" points="133 133.87 147.09 124.7 133 133.87 133 133.87"/><path class="cls-8" d="M124.41 150.23l3.24-12.87 5.36-3.49 14.09-9.17v-.02l12.83-6.18 2.47-1.19c-2.4.69-4.75 1.48-7.06 2.25-3.11 1.04-6.13 2.05-9.09 2.77l-1.51-4.27c-1.64-4.1-3.34-9.2-4.98-14.56.74-4.26.97-8.66.72-13.04.92.34 1.86.65 2.83.9 6.74 1.69 13.32.05 17.61-4.39 4.76-4.92 6.22-13.03 3.74-20.65-1.97-6.05-5.76-10.64-9.11-14.68l-.39-.48-10.48-8.4c-2.6-2.08-6.38-1.67-8.47.93-2.08 2.59-1.67 6.38.93 8.47l9.51 7.63c2.67 3.23 5.34 6.58 6.55 10.27 1.05 3.22.64 6.9-.95 8.55-1.48 1.53-4.08 1.56-6.02 1.07-2.7-.68-5.46-2.34-8.37-4.1-.11-.07-.22-.13-.32-.19-.7-2.04-1.52-4.03-2.47-5.94-10.92-22.15-37.7-31.28-59.8-20.38-22.1 10.9-31.17 37.69-20.25 59.85 4.99 10.12 14.09 18.58 24.61 23.75l1.1 10.21c-.41 4.17-.89 8.43-2.65 11.89-1.54 3.02-4.43 5.32-6.72 5.36h-.06c-2.11.0-3.94-1.8-4.95-3.5-1.43-2.39-2.19-5.52-3.01-8.83-.13-.51-.25-1.02-.38-1.53-1.32-5.25-3.18-11.31-6.97-16.41-3.27-4.39-7.43-7.25-12.03-8.26-5.44-1.19-10.48.36-13.75 1.86-4.16 1.92-7.57 4.69-10.07 6.89s-2.74 6-.54 8.5c2.2 2.5 6 2.74 8.5.54 2.8-2.46 5-4 7.15-4.99 2.23-1.02 4.47-1.4 6.14-1.04 2.18.48 3.89 2.26 4.94 3.67 2.52 3.39 3.87 7.85 4.96 12.16.12.49.24.98.36 1.46.94 3.84 2.01 8.18 4.36 12.12 3.51 5.89 9.21 9.38 15.3 9.38.08.0.16.0.25.0 6.85-.11 13.62-4.79 17.26-11.93 2.89-5.67 3.46-11.59 3.97-16.82l.06-.61-.33-3.02c2.07 2.29 4.06 4.75 5.87 7.35.44 3.01.79 5.93 1.01 8.43.24 7.96-.97 12.64-3.8 14.71-1.38 1.01-3.42 1.58-5.77 2.24-1.49.42-3.03.85-4.61 1.46-11.1 4.23-18.84 15.49-18.81 27.37.0 3.32 2.7 6.01 6.02 6.01h.01c3.33.0 6.02-2.71 6.01-6.04-.01-6.87 4.64-13.64 11.06-16.09 1.08-.41 2.29-.75 3.58-1.12 3.03-.85 6.47-1.82 9.61-4.11 8.37-6.1 8.99-17.19 8.74-25l-.02-.32c-.06-.72-.18-1.93-.35-3.49l.13-.31.84.31c.01 1.03.29 2.07.85 3.01 3.23 5.38 3.3 12.64.17 18.08-.95 1.65-2.23 3.29-3.6 5.02-2.59 3.3-5.52 7.03-6.86 11.89-2.57 9.32 1.89 18.34 4.84 24.3 1.05 2.12 3.18 3.36 5.4 3.36.9.0 1.81-.2 2.66-.63 2.98-1.47 4.2-5.09 2.73-8.07-2.83-5.73-5.27-11.25-4.02-15.77.69-2.53 2.56-4.9 4.72-7.65.22-.28.44-.56.66-.84.92-1.18 1.84-2.39 2.71-3.69.42-.62.82-1.26 1.2-1.93 4.53-7.88 5.1-17.68 1.77-26.07h0c-.24-.61-.51-1.22-.79-1.81"/><path class="cls-8" d="M125.27 152.2c-.24-.61-.51-1.22-.79-1.81.28.6.55 1.2.79 1.81z"/><polygon class="cls-8" points="133 133.87 127.64 137.36 133 133.87 133 133.87"/><path class="cls-7" d="M109.05 60.27c10.17 5.87 16.58 14.81 16.72 22.23 3.48-7.92-2.18-19.01-13.23-25.4-8.92-5.15-18.74-5.72-24.89-2.09 6.21-.75 14.01.98 21.41 5.25z"/><ellipse class="cls-7" cx="124.64" cy="108.25" rx="4.78" ry="5.91"/><circle class="cls-2" cx="126.13" cy="111.92" r="2.42"/><path class="cls-7" d="M115.8 130.96c.85-.76 1.86-1.52 3.05-2.22-3.01-.86-12.56-3.14-13.32 2.08.0.0-.81 2.32 7.25 3.67.28-.44.63-.95 1.09-1.51l1.92-2.02z"/><path class="cls-2" d="M128.78 125.87c-4.22.28-7.47 1.44-9.93 2.87-1.2.7-2.21 1.46-3.05 2.22l-4.43-1.05c-.65-.16-1.3.25-1.45.89-.15.65.25 1.3.89 1.45l3.06.72c-.45.56-.81 1.07-1.09 1.51-.49.77-.73 1.3-.76 1.39-.26.61.02 1.31.63 1.58.16.07.32.1.48.1.47.0.91-.27 1.11-.73.14-.32 3.54-7.83 14.71-8.56.66-.04 1.17-.62 1.12-1.28-.04-.66-.62-1.16-1.28-1.12z"/><path class="cls-2" d="M80.49 116.01c.54-2.16 2.42-3.9 4.67-4.1 2.96-.26 5.7 1.9 8.24 3.08 2.89 1.35 6.87 3.08 9.93 1.27 3.06-1.82 2.93-6.13-.39-7.51-1-.42-2.21.45-2.47 1.4-.32 1.15.4 2.05 1.4 2.47.67.28-.45-.25-.32-.23.65.09-.17.34.03.13-.26.27-.48.41-.87.48-1.21.2-2.61-.43-3.71-.83-2.71-.99-5.09-2.68-7.82-3.64-2.64-.93-5.48-.86-7.96.49-2.26 1.23-3.97 3.42-4.6 5.91-.63 2.51 3.24 3.58 3.87 1.07h0z"/><path class="cls-4" d="M71.99 65.75 55.66 50.84S31.43 66.09 37.64 85.85l19.46 7.44s14.67-24.51 14.89-27.53z"/><path class="cls-6" d="M57.17 93.18l-.07.1c.36 4.79 2.63 7.89 5.31 9.9 3.72 2.79 9.04.19 9.06-4.46.02-6.87.95-16.03 1.7-22.41-.61 2.13-1.57 4.39-2.86 6.63-3.89 6.73-9.45 10.94-13.14 10.23z"/><path class="cls-4" d="M73.95 70.21c-.03-.34-.07-.66-.13-.97-.3-1.66-1.02-2.93-2.18-3.6-3.59-2.07-10 2.32-14.32 9.81-4.32 7.49-4.92 15.24-1.34 17.31.36.21.76.34 1.18.42 3.69.71 9.26-3.5 13.14-10.23 1.29-2.24 2.25-4.5 2.86-6.63.65-2.25.92-4.35.78-6.11z"/><ellipse class="cls-5" cx="48.91" cy="70.52" rx="15.66" ry="7.5" transform="translate(-36.62 77.62) rotate(-60)"/><path class="cls-2" d="M96.23 128.29c-.63.0-1.16-.48-1.2-1.12.0-.12-.17-2.97 2.19-5.08 2.33-2.07 6.15-2.64 11.38-1.69.65.12 1.09.75.97 1.4s-.75 1.08-1.4.97c-4.37-.8-7.59-.43-9.31 1.09-1.49 1.31-1.42 3.08-1.42 3.15.03.66-.47 1.23-1.13 1.27-.02.0-.05.0-.07.0z"/><path class="cls-4" d="M45.67 79.05s-6.32-13.34 9.3-15.44c0 0 .88 9.3-9.3 15.44z"/><path class="cls-7" d="M66.44 80.81c-.08.0-.16-.02-.23-.07l-7.44-5.27c-.18-.13-.22-.38-.1-.56.13-.18.38-.22.56-.1l7.44 5.27c.18.13.22.38.1.56-.08.11-.2.17-.33.17z"/><path class="cls-7" d="M61.37 83.61c-.22.0-.4-.18-.4-.4s.18-.4.4-.4c2.12.0 3.68-.62 4.64-1.86 1.89-2.43.89-6.45.88-6.49-.05-.21.08-.43.29-.49.21-.06.43.08.49.29.05.18 1.1 4.45-1.02 7.18-1.12 1.44-2.89 2.17-5.27 2.17z"/><path class="cls-7" d="M59.92 80.51c-.07.0-.15-.02-.21-.06-.19-.12-.25-.36-.13-.55l3.68-5.94c.12-.19.37-.24.55-.13.19.12.25.36.13.55l-3.68 5.94c-.08.12-.21.19-.34.19z"/><path class="cls-3" d="M133 133.87l-5.36 3.49-3.24 12.87c.03.05.05.11.07.16.28.6.55 1.2.79 1.81h0c3.33 8.39 2.76 18.18-1.77 26.07-.38.67-.79 1.31-1.2 1.93-.87 1.3-1.79 2.51-2.71 3.69l19.75 24.77 2.65 3.33h43.52l2.65-3.33 3.87-4.86-2.11-4.44-2.11-4.44-1.53-3.21 5.22-1.42 1.9-.52.81-2.88 1.46-5.22 2.26.55 4.73 1.16 4.73 1.16 2.59-3.25 2.65-3.33-.95-4.15-5.08-22.27-2.71-11.87-.95-4.15-3.83-1.85-31.54-15.19-3.46-1.67c-.58.15-1.16.31-1.73.48l-2.47 1.19-12.84 6.18v.02l-14.08 9.17"/><path class="cls-7" d="M176.83 169.95c.1-.37.43-.63.81-.63h4.41c.14-.9.21-1.77.21-2.65s-.07-1.74-.21-2.65h-4.41c-.38.0-.72-.26-.81-.63-.31-1.18-.78-2.31-1.4-3.35-.2-.33-.14-.75.13-1.02l3.11-3.11c-1.07-1.43-2.33-2.68-3.76-3.73l-3.13 3.13c-.27.27-.69.32-1.01.13-1.03-.6-2.15-1.05-3.33-1.34-.37-.09-.64-.43-.64-.82v-4.39c-1.84-.27-3.52-.25-5.29.03v4.43c0 .38-.25.71-.62.81-1.14.31-2.23.77-3.24 1.37-.33.2-.75.15-1.02-.13l-3.11-3.11c-1.43 1.07-2.68 2.33-3.73 3.76l3.13 3.13c.27.27.32.69.13 1.02-.58.99-1.02 2.08-1.32 3.21-.1.37-.43.63-.81.63h-4.41c-.14.9-.21 1.77-.21 2.65s.07 1.74.21 2.65h4.41c.38.0.72.26.81.63.3 1.14.74 2.22 1.32 3.21.19.33.14.75-.13 1.02l-3.13 3.13c1.05 1.43 2.3 2.68 3.73 3.76l3.11-3.11c.27-.27.7-.32 1.02-.13 1.01.6 2.1 1.06 3.24 1.37.37.1.62.43.62.81v4.43c1.77.28 3.45.3 5.29.03v-4.39c0-.39.26-.72.64-.82 1.17-.29 2.29-.75 3.33-1.34.33-.19.74-.14 1.01.13l3.13 3.13c1.43-1.05 2.69-2.3 3.76-3.73l-3.11-3.11c-.27-.27-.32-.69-.13-1.02.62-1.04 1.09-2.17 1.4-3.35zM164.28 174.34c-4.23.0-7.67-3.44-7.67-7.67s3.44-7.67 7.67-7.67 7.67 3.44 7.67 7.67-3.44 7.67-7.67 7.67z"/><polygon class="cls-5" points="195.75 132.09 189.83 137.14 192.61 143.99 180.11 144.21 191.23 147.66 189.37 154.85 195.84 146.32 193.15 138.65 200.11 134.06 195.75 132.09"/><polygon class="cls-5" points="126.43 142.34 133.2 146.69 139.04 142.17 142.63 154.14 142.95 142.5 150.38 142.35 140.41 138.43 133.75 143.09 127.55 137.77 126.43 142.34"/><polygon class="cls-5" points="141.99 211.98 151.62 206.63 147.49 195.75 149.23 193.05 153.13 187.67 143.3 194.01 147.65 204.83 138.76 207.97 141.99 211.98"/><path class="cls-1" d="M125.19 96.63c-6.01.0-10.89 4.89-10.89 10.89s4.89 10.89 10.89 10.89 10.89-4.89 10.89-10.89-4.89-10.89-10.89-10.89z"/><path class="cls-2" d="M158.9 109.67h9.99c1.33.0 2.41-1.08 2.41-2.41s-1.08-2.41-2.41-2.41h-5.48c-1.71 1.37-3.22 2.99-4.5 4.82z"/><path class="cls-8" d="M213.42 121.88l-.06.08c-.57-19.01-16.2-34.3-35.35-34.3-12.46.0-23.94 6.56-30.32 17.19-.24.4-.49.79-.71 1.2-.63 1.15-.84 2.41-.69 3.62.23 1.86 1.31 3.59 3.08 4.56 2.92 1.6 6.58.53 8.18-2.39.41-.76.88-1.48 1.36-2.17 1.28-1.83 2.8-3.45 4.5-4.82 4.08-3.27 9.2-5.14 14.6-5.14 12.86.0 23.33 10.47 23.33 23.33.0 2.63-.13 3.57-.77 5.61-.21.68-.29 1.37-.26 2.05-7.77-8.95-17.68-16.91-29.9-15.17-2.15.31-4.24.76-6.29 1.31l3.46 1.67 31.54 15.19 3.83 1.85.95 4.15 2.71 11.87c.49-.19.97-.42 1.42-.75 2.69-1.96 3.29-5.72 1.33-8.41-.17-.24-.35-.48-.52-.72 1.88-3.42 2.99-7.38 3.64-10.85.75-2.8.9-4.87.9-7.78.0-.01.0-.02.0-.03.03-.71.03-1.12.03-1.12z"/><path class="cls-2" d="M147.69 104.85h-7.04c-1.28-7.39-7.72-13.04-15.47-13.04-8.66.0-15.71 7.05-15.71 15.71s7.05 15.71 15.71 15.71c7.94.0 14.5-5.92 15.55-13.57h5.55c-.15-1.21.06-2.47.69-3.62.22-.41.47-.8.71-1.2zm-22.5 13.57c-6.01.0-10.89-4.89-10.89-10.89s4.89-10.89 10.89-10.89 10.89 4.89 10.89 10.89-4.89 10.89-10.89 10.89z"/><polygon class="cls-4" points="23.71 152.66 40.01 153.84 40.9 145.48 47.6 142.38 39.37 130.63 20.5 143.35 23.71 152.66"/></svg></span><span class="navbar-brand__name">Krkn</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/docs/"><span>Documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/blog/"><span>Blog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/community/"><span>Community</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/krkn-chaos/" target="_blank" rel="noopener"><i class='fab fa-github'></i> <span>Github</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/scenarios/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Scenarios</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-c519395ea211e39cc6cc5ef047185c90">Application Outage Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-c6685cc58811d9965da768590d1c7b36">Application Outage Scenarios using Krkn</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-56794da11c19d01c8746a72290b04ae1">Application outage Scenario using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-a0f3c55c3812d8d9972fb401fa90997f">Arcaflow Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-3b6badec7f06927507195203795ebd14">Arcaflow Scenarios using Krkn</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-5b042b0ace5c7a9fddf4314f18cffbe8">Container Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-6b0970e4eb72407e459e00dcf868edd0">Container Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.2: <a href="#pg-93508b71407800a4fd12c130146c8c29">Container Scenarios using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-453f0d3bacab710a741dfc6447534e67">CPU Hog Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-c35b125e7cb7975c42e6c99f8e45340a">CPU Hog Scenarios using Krkn</a></li>


    
  
    
    
	
<li>4.2: <a href="#pg-f182958d88fb20776b8a10c969271e32">CPU Hog Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-92869ed19e15fe8a8f9327d35eb0a8ef">IO Hog Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-061db2db4cf2d6fb8b918615b8fd2dda">IO Hog Scenarios using Krkn</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-3a7a19e3ba7417a217ade8504634e037">IO Hog Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-f25a2b90c8720ca76c4391ef2a5779e8">ManagedCluster Scenarios</a></li>


    
  
    
    
	
<li>7: <a href="#pg-4afdb6f0fd755ca703a0d7520b8daf50">Memory Hog Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>7.1: <a href="#pg-dbc32c76f347cc59694c7aa38a113a33">Memory Hog Scenarios using Krkn</a></li>


    
  
    
    
	
<li>7.2: <a href="#pg-4235987e3f2a8cb2f643e68610a28e16">Memory Hog Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>8: <a href="#pg-993237ebf800e696ef64cc0a59b19cee">Network Chaos Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>8.1: <a href="#pg-6946ebccc0f4758c518336c6a1eab7ef">PVC Scenario using Krkn</a></li>


    
  
    
    
	
<li>8.2: <a href="#pg-58617b5353469d215cd71c3a97f65a3d">Network Chaos Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>9: <a href="#pg-f16f359a8dea60e9d83ad2f901728e3d">Node Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>9.1: <a href="#pg-774f55781c04704bbc35442200005082">Node Scenarios using Krkn</a></li>


    
  
    
    
	
<li>9.2: <a href="#pg-41b7887a58c35ebdc959d9678afaee4b">Node Scenarios using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>10: <a href="#pg-affd85910adbdf9ad08c6ed992c6bb14">Pod Network Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>10.1: <a href="#pg-3113de3ae94ded0c459e52ecda391a77">Pod Scenarios using Krkn</a></li>


    
  
    
    
	
<li>10.2: <a href="#pg-5edf70896392385f5e879c8c6af1559c">Pod Network Chaos Scenarios using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>11: <a href="#pg-abccb6686f7f738ead88a179903bd631">Pod Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>11.1: <a href="#pg-95b830de59fc16f5bfb39617cfcd5402">Pod Scenarios using Krkn</a></li>


    
  
    
    
	
<li>11.2: <a href="#pg-dd864f90e71659610098eefe5ef8e784">Pod Scenarios using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>12: <a href="#pg-ce8b54635e230b2999da190ebd1e41be">Power Outage Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>12.1: <a href="#pg-86b7bbcde807ac105b3ed9bf4854bc3d">Power Outage Scenario using Krkn</a></li>


    
  
    
    
	
<li>12.2: <a href="#pg-f78409366ed557faa404a782e364505b">Power Outage Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>13: <a href="#pg-894d789e8e0ad80e01add4fc659d4230">PVC Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>13.1: <a href="#pg-042a0835bd60597669c3f484912f9e1e">PVC Scenario using Krkn</a></li>


    
  
    
    
	
<li>13.2: <a href="#pg-a07e0c044e3bf878a9d652efab248a8a">PVC Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>14: <a href="#pg-71b2337dd184e179e48995c1b262ac17">Service Disruption Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>14.1: <a href="#pg-c229626aef295356c4fa6fb05ffe42db">Service Disruption Scenarios using Krkn</a></li>


    
  
    
    
	
<li>14.2: <a href="#pg-afd27124a9063adebb9970a5b2f94b01">Service Disruption Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>15: <a href="#pg-ce393854ff3da73a278e77f5f3f45ac4">Service Hijacking Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>15.1: <a href="#pg-0326ec69aa2cf1ccbeb0b57479a77dba">Service Hijacking Scenarios using Krkn</a></li>


    
  
    
    
	
<li>15.2: <a href="#pg-8645cf3ca8634c69a0c8ad7ac90fbe06">Service Hijacking Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>16: <a href="#pg-a4fbbfbd8b11ce2dd79180e169a6c09c">Time Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>16.1: <a href="#pg-4e099f299e4e2e9c590fc5a8f3dbdb1f">Time Scenarios using Krkn</a></li>


    
  
    
    
	
<li>16.2: <a href="#pg-f029f0161de9931fff733ccc2fde58e5">Time Skew Scenarios using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>17: <a href="#pg-de67113eb2d27bfedac46c07b5c4db22">Zone Outage Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>17.1: <a href="#pg-a98bdfa4b92598e3eeed675e2a73ea11">Zone Outage Scenarios using Krkn</a></li>


    
  
    
    
	
<li>17.2: <a href="#pg-ac460820001befdfa88a92bc5f36f753">Zone Outage Scenarios using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>18: <a href="#pg-31dc471e07bb163ac298937597cfdea2">All Scenarios Variables</a></li>


    
  
    
    
	
<li>19: <a href="#pg-41ff6593888c87620d21a5a31c783466">Supported Cloud Providers</a></li>


    
  

    </ul>


<div class="content">
      <h3 id="supported-chaos-scenarios">Supported chaos scenarios<a class="td-heading-self-link" href="#supported-chaos-scenarios" aria-label="Heading self-link"></a></h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/docs/scenarios/pod-scenario/">Pod failures</a></td>
<td>Injects pod failures</td>
</tr>
<tr>
<td><a href="/docs/scenarios/container-scenario/">Container failures</a></td>
<td>Injects container failures based on the provided kill signal</td>
</tr>
<tr>
<td><a href="/docs/scenarios/node-scenarios/">Node failures</a></td>
<td>Injects node failure through OpenShift/Kubernetes, cloud API&rsquo;s</td>
</tr>
<tr>
<td><a href="/docs/scenarios/zone-outage-scenarios/">zone outages</a></td>
<td>Creates zone outage to observe the impact on the cluster, applications</td>
</tr>
<tr>
<td><a href="/docs/scenarios/time-scenarios/">time skew</a></td>
<td>Skews the time and date</td>
</tr>
<tr>
<td><a href="/docs/scenarios/cpu-hog-scenario/">Node cpu hog</a></td>
<td>Hogs CPU on the targeted nodes</td>
</tr>
<tr>
<td><a href="/docs/scenarios/memory-hog-scenario/">Node memory hog</a></td>
<td>Hogs memory on the targeted nodes</td>
</tr>
<tr>
<td><a href="/docs/scenarios/io-hog-scenario/">Node IO hog</a></td>
<td>Hogs io on the targeted nodes</td>
</tr>
<tr>
<td><a href="/docs/scenarios/service-disruption-scenarios/">Service Disruption</a></td>
<td>Deleting all objects within a namespace</td>
</tr>
<tr>
<td><a href="/docs/scenarios/application-outage/">Application outages</a></td>
<td>Isolates application Ingress/Egress traffic to observe the impact on dependent applications and recovery/initialization timing</td>
</tr>
<tr>
<td><a href="/docs/scenarios/power-outage-scenarios/">Power Outages</a></td>
<td>Shuts down the cluster for the specified duration and turns it back on to check the cluster health</td>
</tr>
<tr>
<td><a href="/docs/scenarios/pvc-scenario/">PVC disk fill</a></td>
<td>Fills up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it</td>
</tr>
<tr>
<td><a href="/docs/scenarios/network-chaos-scenario/">Network Chaos</a></td>
<td>Introduces network latency, packet loss, bandwidth restriction in the egress traffic of a Node&rsquo;s interface using tc and Netem</td>
</tr>
<tr>
<td><a href="/docs/scenarios/pod-network-scenario/">Pod Network Chaos</a></td>
<td>Introduces network chaos at pod level</td>
</tr>
<tr>
<td><a href="/docs/scenarios/service-hijacking-scenario/">Service Hijacking</a></td>
<td>Hijacks a service http traffic to simulate custom HTTP responses</td>
</tr>
</tbody>
</table>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c519395ea211e39cc6cc5ef047185c90">1 - Application Outage Scenarios</h1>
    
	<h3 id="application-outages">Application outages<a class="td-heading-self-link" href="#application-outages" aria-label="Heading self-link"></a></h3>
<p>Scenario to block the traffic ( Ingress/Egress ) of an application matching the labels for the specified duration of time to understand the behavior of the service/other services which depend on it during downtime. This helps with planning the requirements accordingly, be it improving the timeouts or tweaking the alerts etc.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c6685cc58811d9965da768590d1c7b36">1.1 - Application Outage Scenarios using Krkn</h1>
    
	<h5 id="sample-scenario-config">Sample scenario config<a class="td-heading-self-link" href="#sample-scenario-config" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">application_outage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                  </span><span style="color:#8f5902;font-style:italic"># Scenario to create an outage of an application by blocking traffic</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">600</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># Duration in seconds after which the routes will be accessible</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;namespace-with-application&gt;           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Namespace to target - all application routes will go inaccessible if pod selector is empty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pod_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">foo}                           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Pods to target</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">block</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Ingress, Egress]                          </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># It can be Ingress or Egress or Ingress, Egress</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="debugging-steps-in-case-of-failures">Debugging steps in case of failures<a class="td-heading-self-link" href="#debugging-steps-in-case-of-failures" aria-label="Heading self-link"></a></h5>
<p>Kraken creates a network policy blocking the ingress/egress traffic to create an outage, in case of failures before reverting back the network policy, you can delete it manually by executing the following commands to stop the outage:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ oc delete networkpolicy/kraken-deny -n &lt;targeted-namespace&gt;
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-56794da11c19d01c8746a72290b04ae1">1.2 - Application outage Scenario using Krkn-hub</h1>
    
	<p>This scenario disrupts the traffic to the specified application to be able to understand the impact of the outage on the dependent service/user experience. Refer <a href="/docs/scenarios/application-outage/">docs</a> for more details.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>DURATION</td>
<td>Duration in seconds after which the routes will be accessible</td>
<td>600</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace to target - all application routes will go inaccessible if pod selector is empty ( Required )</td>
<td>No default</td>
</tr>
<tr>
<td>POD_SELECTOR</td>
<td>Pods to target. For example &ldquo;{app: foo}&rdquo;</td>
<td>No default</td>
</tr>
<tr>
<td>BLOCK_TRAFFIC_TYPE</td>
<td>It can be Ingress or Egress or Ingress, Egress ( needs to be a list )</td>
<td>[Ingress, Egress]</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Defining the <code>NAMESPACE</code> parameter is required for running this scenario while the pod_selector is optional. In case of using pod selector to target a particular application, make sure to define it using the following format with a space between key and value: “{key: value}”.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452403?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a0f3c55c3812d8d9972fb401fa90997f">2 - Arcaflow Scenarios</h1>
    
	<p>Arcaflow is a workflow engine in development which provides the ability to execute workflow steps in sequence, in parallel, repeatedly, etc. The main difference to competitors such as Netflix Conductor is the ability to run ad-hoc workflows without an infrastructure setup required.</p>
<p>The engine uses containers to execute plugins and runs them either locally in Docker/Podman or remotely on a Kubernetes cluster. The workflow system is strongly typed and allows for generating JSON schema and OpenAPI documents for all data formats involved.</p>
<h3 id="available-scenarios">Available Scenarios<a class="td-heading-self-link" href="#available-scenarios" aria-label="Heading self-link"></a></h3>
<h4 id="hog-scenarios">Hog scenarios:<a class="td-heading-self-link" href="#hog-scenarios" aria-label="Heading self-link"></a></h4>
<ul>
<li><a href="/docs/scenarios/cpu-hog-scenario/">CPU Hog</a></li>
<li><a href="/docs/scenarios/memory-hog-scenario/">Memory Hog</a></li>
<li><a href="/docs/scenarios/io-hog-scenario/">I/O Hog</a></li>
</ul>
<h3 id="prequisites">Prequisites<a class="td-heading-self-link" href="#prequisites" aria-label="Heading self-link"></a></h3>
<p>Arcaflow supports three deployment technologies:</p>
<ul>
<li>Docker</li>
<li>Podman</li>
<li>Kubernetes</li>
</ul>
<h4 id="docker">Docker<a class="td-heading-self-link" href="#docker" aria-label="Heading self-link"></a></h4>
<p>In order to run Arcaflow Scenarios with the Docker deployer, be sure that:</p>
<ul>
<li>Docker is correctly installed in your Operating System (to find instructions on how to install docker please refer to <a href="https://www.docker.com/">Docker Documentation</a>)</li>
<li>The Docker daemon is running</li>
</ul>
<h4 id="podman">Podman<a class="td-heading-self-link" href="#podman" aria-label="Heading self-link"></a></h4>
<p>The podman deployer is built around the podman CLI and doesn&rsquo;t need necessarily to be run along with the podman daemon.
To run Arcaflow Scenarios in your Operating system be sure that:</p>
<ul>
<li>podman is correctly installed in your Operating System (to find instructions on how to install podman refer to <a href="https://podman.io/">Podman Documentation</a>)</li>
<li>the podman CLI is in your shell PATH</li>
</ul>
<h4 id="kubernetes">Kubernetes<a class="td-heading-self-link" href="#kubernetes" aria-label="Heading self-link"></a></h4>
<p>The kubernetes deployer integrates directly the Kubernetes API Client and needs only a valid kubeconfig file and a reachable Kubernetes/OpenShift Cluster.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3b6badec7f06927507195203795ebd14">2.1 - Arcaflow Scenarios using Krkn</h1>
    
	<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5b042b0ace5c7a9fddf4314f18cffbe8">3 - Container Scenarios</h1>
    
	<p>Kraken uses the <code>oc exec</code> command to <code>kill</code> specific containers in a pod.
This can be based on the pods namespace or labels. If you know the exact object you want to kill, you can also specify the specific container name or pod name in the scenario yaml file.
These scenarios are in a simple yaml format that you can manipulate to run your specific tests or use the pre-existing scenarios to see how it works.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6b0970e4eb72407e459e00dcf868edd0">3.1 - Container Scenarios using Krkn</h1>
    
	<h4 id="example-config">Example Config<a class="td-heading-self-link" href="#example-config" aria-label="Heading self-link"></a></h4>
<p>The following are the components of Kubernetes for which a basic chaos scenario config exists today.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;name of scenario&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;specific namespace&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># can specify &#34;*&#34; if you want to find in all namespaces</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;label of pod(s)&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">container_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;specific container name&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This is optional, can take out and will kill all containers in all pods found under namespace and label</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pod_names</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This is optional, can take out and will select all pods with given namespace and label</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">&lt;pod_name&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;number of containers to disrupt, default=1&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">action</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;kill signal to run. For example 1 ( hang up ) or 9. Default is set to 1&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expected_recovery_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;number of seconds to wait for container to be running again&gt; (defaults to 120seconds)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="post-action">Post Action<a class="td-heading-self-link" href="#post-action" aria-label="Heading self-link"></a></h4>
<p>In all scenarios we do a post chaos check to wait and verify the specific component.</p>
<p>Here there are two options:</p>
<ol>
<li>Pass a custom script in the main config scenario list that will run before the chaos and verify the output matches post chaos scenario.</li>
</ol>
<p>See <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/post_action_etcd_container.py">scenarios/post_action_etcd_container.py</a> for an example.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">container_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                 </span><span style="color:#8f5902;font-style:italic"># List of chaos pod scenarios to load.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- - <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/container_etcd.yml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/post_action_etcd_container.py</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ol start="2">
<li>Allow kraken to wait and check the killed containers until they become ready again. Kraken keeps a list of the specific
containers that were killed as well as the namespaces and pods to verify all containers that were affected recover properly.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">expected_recovery_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;seconds to wait for container to recover&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-93508b71407800a4fd12c130146c8c29">3.2 - Container Scenarios using Krkn-hub</h1>
    
	<p>This scenario disrupts the containers matching the label in the specified namespace on a Kubernetes/OpenShift cluster.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>NAMESPACE</td>
<td>Targeted namespace in the cluster</td>
<td>openshift-etcd</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the container(s) to target</td>
<td>k8s-app=etcd</td>
</tr>
<tr>
<td>DISRUPTION_COUNT</td>
<td>Number of container to disrupt</td>
<td>1</td>
</tr>
<tr>
<td>CONTAINER_NAME</td>
<td>Name of the container to disrupt</td>
<td>etcd</td>
</tr>
<tr>
<td>ACTION</td>
<td>kill signal to run. For example 1 ( hang up ) or 9</td>
<td>1</td>
</tr>
<tr>
<td>EXPECTED_RECOVERY_TIME</td>
<td>Time to wait before checking if all containers that were affected recover properly</td>
<td>60</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Set NAMESPACE environment variable to <code>openshift-.*</code> to pick and disrupt pods randomly in openshift system namespaces, the DAEMON_MODE can also be enabled to disrupt the pods every x seconds in the background to check the reliability.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/BXqs9JSGDSEKcydTIJ5LpPZBM?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-453f0d3bacab710a741dfc6447534e67">4 - CPU Hog Scenario</h1>
    
	<p>This scenario is based on the arcaflow <a href="https://github.com/arcalot/arcaflow-plugin-stressng">arcaflow-plugin-stressng</a> plugin.
The purpose of this scenario is to create cpu pressure on a particular node of the Kubernetes/OpenShift cluster for a time span.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c35b125e7cb7975c42e6c99f8e45340a">4.1 - CPU Hog Scenarios using Krkn</h1>
    
	<p>To enable this plugin add the pointer to the scenario input file <code>scenarios/arcaflow/cpu-hog/input.yaml</code> as described in the
<a href="/docs/scenarios/cpu-hog-scenario/cpu-hog-scenario-krkn/#usage">Usage</a> section.
This scenario takes a list of objects named <code>input_list</code> with the following properties:</p>
<ul>
<li><strong>kubeconfig :</strong> <em>string</em> the kubeconfig needed by the deployer to deploy the sysbench plugin in the target cluster</li>
<li><strong>namespace :</strong> <em>string</em> the namespace where the scenario container will be deployed
<strong>Note:</strong> this parameter will be automatically filled by kraken if the <code>kubeconfig_path</code> property is correctly set</li>
<li><strong>node_selector :</strong> <em>key-value map</em> the node label that will be used as <code>nodeSelector</code> by the pod to target a specific cluster node</li>
<li><strong>duration :</strong> <em>string</em> stop  stress  test  after  N  seconds.  One  can  also specify the units of time in seconds, minutes, hours, days or years with the suffix s, m, h, d or y.</li>
<li><strong>cpu_count :</strong> <em>int</em> the number of CPU cores to be used (0 means all)</li>
<li><strong>cpu_method :</strong> <em>string</em> a fine-grained control of which cpu stressors to use (ackermann, cfloat etc. see <a href="https://manpages.org/sysbench">manpage</a> for all the cpu_method options)</li>
<li><strong>cpu_load_percentage :</strong> <em>int</em> the CPU load by percentage</li>
</ul>
<p>To perform several load tests in the same run simultaneously (eg. stress two or more nodes in the same run) add another item
to the <code>input_list</code> with the same properties (and eventually different values eg. different node_selectors
to schedule the pod on different nodes). To reduce (or increase) the parallelism change the value <code>parallelism</code> in <code>workload.yaml</code> file</p>
<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f182958d88fb20776b8a10c969271e32">4.2 - CPU Hog Scenario using Krkn-Hub</h1>
    
	<p>This scenario hogs the cpu on the specified node on a Kubernetes/OpenShift cluster for a specified duration. For more information refer the following <a href="/docs/scenarios/cpu-hog-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>TOTAL_CHAOS_DURATION</td>
<td>Set chaos duration (in sec) as desired</td>
<td>60</td>
</tr>
<tr>
<td>NODE_CPU_CORE</td>
<td>Number of cores (workers) of node CPU to be consumed</td>
<td>2</td>
</tr>
<tr>
<td>NODE_CPU_PERCENTAGE</td>
<td>Percentage of total cpu to be consumed</td>
<td>50</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace where the scenario container will be deployed</td>
<td>default</td>
</tr>
<tr>
<td>NODE_SELECTORS</td>
<td>Node selectors where the scenario containers will be scheduled in the format &ldquo;<code>&lt;selector&gt;=&lt;value&gt;</code>&rdquo;. <strong>NOTE</strong>: This value can be specified as a list of node selectors separated by &ldquo;<code>;</code>&rdquo;. Will be instantiated a container per each node selector with the same scenario options. This option is meant to run one or more stress scenarios simultaneously on different nodes, kubernetes will schedule the pods on the target node accordingly with the selector specified. Specifying the same selector multiple times will  instantiate as many scenario container as the number of times the selector is specified on the same node</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452762">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-92869ed19e15fe8a8f9327d35eb0a8ef">5 - IO Hog Scenario</h1>
    
	<p>This scenario is based on the arcaflow <a href="https://github.com/arcalot/arcaflow-plugin-stressng">arcaflow-plugin-stressng</a> plugin.
The purpose of this scenario is to create disk pressure on a particular node of the Kubernetes/OpenShift cluster for a time span.
The scenario allows to attach a node path to the pod as a <code>hostPath</code> volume.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-061db2db4cf2d6fb8b918615b8fd2dda">5.1 - IO Hog Scenarios using Krkn</h1>
    
	<p>To enable this plugin add the pointer to the scenario input file <code>scenarios/arcaflow/io-hog/input.yaml</code> as described in the
<a href="/docs/scenarios/io-hog-scenario/io-hog-scenario-krkn/#usage">Usage</a> section.
This scenario takes a list of objects named <code>input_list</code> with the following properties:</p>
<ul>
<li><strong>kubeconfig :</strong> <em>string</em> the kubeconfig needed by the deployer to deploy the sysbench plugin in the target cluster</li>
<li><strong>namespace :</strong> <em>string</em> the namespace where the scenario container will be deployed
<strong>Note:</strong> this parameter will be automatically filled by kraken if the <code>kubeconfig_path</code> property is correctly set</li>
<li><strong>node_selector :</strong> <em>key-value map</em> the node label that will be used as <code>nodeSelector</code> by the pod to target a specific cluster node</li>
<li><strong>duration :</strong> <em>string</em> stop  stress  test  after  N  seconds.  One  can  also specify the units of time in seconds, minutes, hours, days or years with the suffix s, m, h, d or y.</li>
<li><strong>target_pod_folder :</strong> <em>string</em> the path in the pod where the volume is mounted</li>
<li><strong>target_pod_volume :</strong> <em>object</em> the <code>hostPath</code> volume definition in the <a href="https://docs.openshift.com/container-platform/3.11/install_config/persistent_storage/using_hostpath.html">Kubernetes/OpenShift</a> format, that will be attached to the pod as a volume</li>
<li><strong>io_write_bytes :</strong> <em>string</em> writes N bytes for each hdd process. The size can be expressed as % of free space on the file system or in units of Bytes, KBytes, MBytes and GBytes using the suffix b, k, m or g</li>
<li><strong>io_block_size :</strong> <em>string</em> size of each write in bytes. Size can be from 1 byte to 4m.</li>
</ul>
<p>To perform several load tests in the same run simultaneously (eg. stress two or more nodes in the same run) add another item
to the <code>input_list</code> with the same properties (and eventually different values eg. different node_selectors
to schedule the pod on different nodes). To reduce (or increase) the parallelism change the value <code>parallelism</code> in <code>workload.yaml</code> file</p>
<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3a7a19e3ba7417a217ade8504634e037">5.2 - IO Hog Scenario using Krkn-Hub</h1>
    
	<p>This scenario hogs the IO on the specified node on a Kubernetes/OpenShift cluster for a specified duration. For more information refer the following <a href="/docs/scenarios/io-hog-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>TOTAL_CHAOS_DURATION</td>
<td>Set chaos duration (in sec) as desired</td>
<td>180</td>
</tr>
<tr>
<td>IO_BLOCK_SIZE</td>
<td>string size of each write in bytes. Size can be from 1 byte to 4m</td>
<td>1m</td>
</tr>
<tr>
<td>IO_WORKERS</td>
<td>Number of stressorts</td>
<td>5</td>
</tr>
<tr>
<td>IO_WRITE_BYTES</td>
<td>string writes N bytes for each hdd process. The size can be expressed as % of free space on the file system or in units of Bytes, KBytes, MBytes and GBytes using the suffix b, k, m or g</td>
<td>10m</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace where the scenario container will be deployed</td>
<td>default</td>
</tr>
<tr>
<td>NODE_SELECTORS</td>
<td>Node selectors where the scenario containers will be scheduled in the format &ldquo;<code>&lt;selector&gt;=&lt;value&gt;</code>&rdquo;. <strong>NOTE</strong>: This value can be specified as a list of node selectors separated by &ldquo;<code>;</code>&rdquo;. Will be instantiated a container per each node selector with the same scenario options. This option is meant to run one or more stress scenarios simultaneously on different nodes, kubernetes will schedule the pods on the target node accordingly with the selector specified. Specifying the same selector multiple times will  instantiate as many scenario container as the number of times the selector is specified on the same node</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/root/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/root/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f25a2b90c8720ca76c4391ef2a5779e8">6 - ManagedCluster Scenarios</h1>
    
	<p><a href="https://open-cluster-management.io/concepts/managedcluster/">ManagedCluster</a> scenarios provide a way to integrate kraken with <a href="https://open-cluster-management.io/">Open Cluster Management (OCM)</a> and <a href="https://www.redhat.com/en/technologies/management/advanced-cluster-management">Red Hat Advanced Cluster Management for Kubernetes (ACM)</a>.</p>
<p>ManagedCluster scenarios leverage <a href="https://open-cluster-management.io/concepts/manifestwork/">ManifestWorks</a> to inject faults into the ManagedClusters.</p>
<p>The following ManagedCluster chaos scenarios are supported:</p>
<ol>
<li><strong>managedcluster_start_scenario</strong>: Scenario to start the ManagedCluster instance.</li>
<li><strong>managedcluster_stop_scenario</strong>: Scenario to stop the ManagedCluster instance.</li>
<li><strong>managedcluster_stop_start_scenario</strong>: Scenario to stop and then start the ManagedCluster instance.</li>
<li><strong>start_klusterlet_scenario</strong>: Scenario to start the klusterlet of the ManagedCluster instance.</li>
<li><strong>stop_klusterlet_scenario</strong>: Scenario to stop the klusterlet of the ManagedCluster instance.</li>
<li><strong>stop_start_klusterlet_scenario</strong>: Scenario to stop and start the klusterlet of the ManagedCluster instance.</li>
</ol>
<p>ManagedCluster scenarios can be injected by placing the ManagedCluster scenarios config files under <code>managedcluster_scenarios</code> option in the Kraken config. Refer to <a href="https://github.com/redhat-chaos/krkn/blob/main/scenarios/kube/managedcluster_scenarios_example.yml">managedcluster_scenarios_example</a> config file.</p>
<pre tabindex="0"><code>managedcluster_scenarios:
  - actions:                                                        # ManagedCluster chaos scenarios to be injected
    - managedcluster_stop_start_scenario
    managedcluster_name: cluster1                                   # ManagedCluster on which scenario has to be injected; can set multiple names separated by comma
    # label_selector:                                               # When managedcluster_name is not specified, a ManagedCluster with matching label_selector is selected for ManagedCluster chaos scenario injection
    instance_count: 1                                               # Number of managedcluster to perform action/select that match the label selector
    runs: 1                                                         # Number of times to inject each scenario under actions (will perform on same ManagedCluster each time)
    timeout: 420                                                    # Duration to wait for completion of ManagedCluster scenario injection
                                                                    # For OCM to detect a ManagedCluster as unavailable, have to wait 5*leaseDurationSeconds
                                                                    # (default leaseDurationSeconds = 60 sec)
  - actions:
    - stop_start_klusterlet_scenario
    managedcluster_name: cluster1
    # label_selector:
    instance_count: 1
    runs: 1
    timeout: 60
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4afdb6f0fd755ca703a0d7520b8daf50">7 - Memory Hog Scenario</h1>
    
	<p>This scenario is based on the arcaflow <a href="https://github.com/arcalot/arcaflow-plugin-stressng">arcaflow-plugin-stressng</a> plugin.
The purpose of this scenario is to create Virtual Memory pressure on a particular node of the Kubernetes/OpenShift cluster for a time span.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-dbc32c76f347cc59694c7aa38a113a33">7.1 - Memory Hog Scenarios using Krkn</h1>
    
	<p>To enable this plugin add the pointer to the scenario input file <code>scenarios/arcaflow/memory-hog/input.yaml</code> as described in the
<a href="/docs/scenarios/memory-hog-scenario/memory-hog-scenario-krkn/#usage">Usage</a> section.
This scenario takes a list of objects named <code>input_list</code> with the following properties:</p>
<ul>
<li><strong>kubeconfig :</strong> <em>string</em> the kubeconfig needed by the deployer to deploy the sysbench plugin in the target cluster</li>
<li><strong>namespace :</strong> <em>string</em> the namespace where the scenario container will be deployed
<strong>Note:</strong> this parameter will be automatically filled by kraken if the <code>kubeconfig_path</code> property is correctly set</li>
<li><strong>node_selector :</strong> <em>key-value map</em> the node label that will be used as <code>nodeSelector</code> by the pod to target a specific cluster node</li>
<li><strong>duration :</strong> <em>string</em> stop  stress  test  after  N  seconds.  One  can  also specify the units of time in seconds, minutes, hours, days or years with the suffix s, m, h, d or y.</li>
<li><strong>vm_bytes :</strong> <em>string</em> N bytes per vm process or percentage of memory used (using the % symbol). The size can be expressed in units of Bytes, KBytes, MBytes and GBytes using the suffix b, k, m or g.</li>
<li><strong>vm_workers :</strong> <em>int</em> Number of VM stressors to be run (0 means 1 stressor per CPU)</li>
</ul>
<p>To perform several load tests in the same run simultaneously (eg. stress two or more nodes in the same run) add another item
to the <code>input_list</code> with the same properties (and eventually different values eg. different node_selectors
to schedule the pod on different nodes). To reduce (or increase) the parallelism change the value <code>parallelism</code> in <code>workload.yaml</code> file</p>
<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4235987e3f2a8cb2f643e68610a28e16">7.2 - Memory Hog Scenario using Krkn-Hub</h1>
    
	<p>This scenario hogs the memory on the specified node on a Kubernetes/OpenShift cluster for a specified duration. For more information refer the following <a href="/docs/scenarios/memory-hog-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>TOTAL_CHAOS_DURATION</td>
<td>Set chaos duration (in sec) as desired</td>
<td>60</td>
</tr>
<tr>
<td>MEMORY_CONSUMPTION_PERCENTAGE</td>
<td>percentage  (expressed with the suffix %) or amount (expressed with the suffix b, k, m or g) of memory to be consumed by the scenario</td>
<td>90%</td>
</tr>
<tr>
<td>NUMBER_OF_WORKERS</td>
<td>Total number of workers (stress-ng threads)</td>
<td>1</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace where the scenario container will be deployed</td>
<td>default</td>
</tr>
<tr>
<td>NODE_SELECTORS</td>
<td>Node selectors where the scenario containers will be scheduled in the format &ldquo;<code>&lt;selector&gt;=&lt;value&gt;</code>&rdquo;. <strong>NOTE</strong>: This value can be specified as a list of node selectors separated by &ldquo;<code>;</code>&rdquo;. Will be instantiated a container per each node selector with the same scenario options. This option is meant to run one or more stress scenarios simultaneously on different nodes, kubernetes will schedule the pods on the target node accordingly with the selector specified. Specifying the same selector multiple times will  instantiate as many scenario container as the number of times the selector is specified on the same node</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452742?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-993237ebf800e696ef64cc0a59b19cee">8 - Network Chaos Scenario</h1>
    
	<p>Scenario to introduce network latency, packet loss, and bandwidth restriction in the Node&rsquo;s host network interface. The purpose of this scenario is to observe faults caused by random variations in the network.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6946ebccc0f4758c518336c6a1eab7ef">8.1 - PVC Scenario using Krkn</h1>
    
	<h5 id="sample-scenario-config-for-egress-traffic-shaping">Sample scenario config for egress traffic shaping<a class="td-heading-self-link" href="#sample-scenario-config-for-egress-traffic-shaping" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">network_chaos</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># Scenario to create an outage by simulating random variations in the network.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">300</span><span style="color:#f8f8f8;text-decoration:underline">                                   </span><span style="color:#8f5902;font-style:italic"># In seconds - duration network chaos will be applied.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">node_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># Comma separated node names on which scenario has to be injected.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/master </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># When node_name is not specified, a node with matching label_selector is selected for running the scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">instance_count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">                               </span><span style="color:#8f5902;font-style:italic"># Number of nodes in which to execute network chaos.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                     </span><span style="color:#8f5902;font-style:italic"># List of interface on which to apply the network restriction.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;ens5&#34;</span><span style="color:#f8f8f8;text-decoration:underline">                                        </span><span style="color:#8f5902;font-style:italic"># Interface name would be the Kernel host network interface name.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">execution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">serial|parallel                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Execute each of the egress options as a single scenario(parallel) or as separate scenario(serial).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">egress</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000">%                                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># percentage</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">bandwidth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">10mbit</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="sample-scenario-config-for-ingress-traffic-shaping-using-a-plugin">Sample scenario config for ingress traffic shaping (using a plugin)<a class="td-heading-self-link" href="#sample-scenario-config-for-ingress-traffic-shaping-using-a-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">network_chaos</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">node_interface_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># Dictionary with key as node name(s) and value as a list of its interfaces to test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">ip-10-0-128-153.us-west-2.compute.internal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">ens5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">genev_sys_6081</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/master </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># When node_interface_name is not specified, nodes with matching label_selector is selected for node chaos scenario injection</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">instance_count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">                               </span><span style="color:#8f5902;font-style:italic"># Number of nodes to perform action/select that match the label selector</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubeconfig_path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">~/.kube/config                </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Path to kubernetes config file. If not specified, it defaults to ~/.kube/config</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">execution_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">parallel                       </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Execute each of the ingress options as a single scenario(parallel) or as separate scenario(serial).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">network_params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">loss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;50%&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">bandwidth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">10mbit</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">wait_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">test_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">60</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#4e9a06">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">Note: For ingress traffic shaping, ensure that your node doesn&#39;</span><span style="color:#000">t have any [IFB](https://wiki.linuxfoundation.org/networking/ifb) interfaces already present. The scenario relies on creating IFBs to do the shaping, and they are deleted at the end of the scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">##### Steps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Pick the nodes to introduce the network anomaly either from node_name or label_selector.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Verify interface list in one of the nodes or use the interface with a default route, as test interface, if no interface is specified by the user.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Set traffic shaping config on node&#39;s interface using tc and netem.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Wait for the duration time.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Remove traffic shaping config on node&#39;s interface.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Remove the job that spawned the pod.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-58617b5353469d215cd71c3a97f65a3d">8.2 - Network Chaos Scenario using Krkn-Hub</h1>
    
	<p>This scenario introduces network latency, packet loss, bandwidth restriction in the egress traffic of a Node&rsquo;s interface using the tc and Netem. For more information refer the following <a href="/docs/scenarios/network-chaos-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:network-chaos
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:network-chaos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <code>export TRAFFIC_TYPE=egress</code> for Egress scenarios and <code>export TRAFFIC_TYPE=ingress</code> for Ingress scenarios

</div>

<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<h5 id="egress-scenarios">Egress Scenarios<a class="td-heading-self-link" href="#egress-scenarios" aria-label="Heading self-link"></a></h5>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>DURATION</td>
<td>Duration in seconds - during with network chaos will be applied.</td>
<td>300</td>
</tr>
<tr>
<td>NODE_NAME</td>
<td>Node name to inject faults in case of targeting a specific node; Can set multiple node names separated by a comma</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>When NODE_NAME is not specified, a node with matching label_selector is selected for running.</td>
<td>node-role.kubernetes.io/master</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Targeted instance count matching the label selector</td>
<td>1</td>
</tr>
<tr>
<td>INTERFACES</td>
<td>List of interface on which to apply the network restriction.</td>
<td>[]</td>
</tr>
<tr>
<td>EXECUTION</td>
<td>Execute each of the egress option as a single scenario(parallel) or as separate scenario(serial).</td>
<td>parallel</td>
</tr>
<tr>
<td>EGRESS</td>
<td>Dictonary of values to set  network latency(latency: 50ms), packet loss(loss: 0.02), bandwidth restriction(bandwidth: 100mbit)</td>
<td>{bandwidth: 100mbit}</td>
</tr>
</tbody>
</table>
<h5 id="ingress-scenarios">Ingress Scenarios<a class="td-heading-self-link" href="#ingress-scenarios" aria-label="Heading self-link"></a></h5>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>DURATION</td>
<td>Duration in seconds - during with network chaos will be applied.</td>
<td>300</td>
</tr>
<tr>
<td>TARGET_NODE_AND_INTERFACE</td>
<td># Dictionary with key as node name(s) and value as a list of its interfaces to test. For example: {ip-10-0-216-2.us-west-2.compute.internal: [ens5]}</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>When NODE_NAME is not specified, a node with matching label_selector is selected for running.</td>
<td>node-role.kubernetes.io/master</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Targeted instance count matching the label selector</td>
<td>1</td>
</tr>
<tr>
<td>EXECUTION</td>
<td>Used to specify whether you want to apply filters on interfaces one at a time or all at once.</td>
<td>parallel</td>
</tr>
<tr>
<td>NETWORK_PARAMS</td>
<td>latency, loss and bandwidth are the three supported network parameters to alter for the chaos test. For example: {latency: 50ms, loss: &lsquo;0.02&rsquo;}</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>WAIT_DURATION</td>
<td>Ensure that it is at least about twice of test_duration</td>
<td>300</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f16f359a8dea60e9d83ad2f901728e3d">9 - Node Scenarios</h1>
    
	<p>This scenario disrupts the node(s) matching the label on a Kubernetes/OpenShift cluster.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-774f55781c04704bbc35442200005082">9.1 - Node Scenarios using Krkn</h1>
    
	<p>The following node chaos scenarios are supported:</p>
<ol>
<li><strong>node_start_scenario</strong>: Scenario to stop the node instance.</li>
<li><strong>node_stop_scenario</strong>: Scenario to stop the node instance.</li>
<li><strong>node_stop_start_scenario</strong>: Scenario to stop and then start the node instance. Not supported on VMware.</li>
<li><strong>node_termination_scenario</strong>: Scenario to terminate the node instance.</li>
<li><strong>node_reboot_scenario</strong>: Scenario to reboot the node instance.</li>
<li><strong>stop_kubelet_scenario</strong>: Scenario to stop the kubelet of the node instance.</li>
<li><strong>stop_start_kubelet_scenario</strong>: Scenario to stop and start the kubelet of the node instance.</li>
<li><strong>restart_kubelet_scenario</strong>: Scenario to restart the kubelet of the node instance.</li>
<li><strong>node_crash_scenario</strong>: Scenario to crash the node instance.</li>
<li><strong>stop_start_helper_node_scenario</strong>: Scenario to stop and start the helper node and check service status.</li>
</ol>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    If the node does not recover from the node_crash_scenario injection, reboot the node to get it back to Ready state.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    node_start_scenario, node_stop_scenario, node_stop_start_scenario, node_termination_scenario
, node_reboot_scenario and stop_start_kubelet_scenario are supported on AWS, Azure, OpenStack, BareMetal, GCP
, VMware and Alibaba.

</div>

<h4 id="aws">AWS<a class="td-heading-self-link" href="#aws" aria-label="Heading self-link"></a></h4>
<p>Cloud setup instructions can be found <a href="/docs/scenarios/cloud_setup/#aws">here</a>. Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/aws_node_scenarios.yml">here</a>.</p>
<h4 id="baremetal">Baremetal<a class="td-heading-self-link" href="#baremetal" aria-label="Heading self-link"></a></h4>
<p>Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/baremetal_node_scenarios.yml">here</a>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>Baremetal requires setting the IPMI user and password to power on, off, and reboot nodes, using the config options <code>bm_user</code> and <code>bm_password</code>. It can either be set in the root of the entry in the scenarios config, or it can be set per machine.</p>
<p>If no per-machine addresses are specified, kraken attempts to use the BMC value in the BareMetalHost object. To list them, you can do &lsquo;oc get bmh -o wide &ndash;all-namespaces&rsquo;. If the BMC values are blank, you must specify them per-machine using the config option &lsquo;bmc_addr&rsquo; as specified below.</p>
<p>For per-machine settings, add a &ldquo;bmc_info&rdquo; section to the entry in the scenarios config. Inside there, add a configuration section using the node name. In that, add per-machine settings. Valid settings are &lsquo;bmc_user&rsquo;, &lsquo;bmc_password&rsquo;, and &lsquo;bmc_addr&rsquo;.
See the example node scenario or the example below.</p>


</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Baremetal requires oc (openshift client) be installed on the machine running Kraken.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Baremetal machines are fragile. Some node actions can occasionally corrupt the filesystem if it does not shut down properly, and sometimes the kubelet does not start properly.

</div>

<h4 id="docker">Docker<a class="td-heading-self-link" href="#docker" aria-label="Heading self-link"></a></h4>
<p>The Docker provider can be used to run node scenarios against kind clusters.</p>
<p><a href="https://kind.sigs.k8s.io/">kind</a> is a tool for running local Kubernetes clusters using Docker container &ldquo;nodes&rdquo;.</p>
<p>kind was primarily designed for testing Kubernetes itself, but may be used for local development or CI.</p>
<h4 id="gcp">GCP<a class="td-heading-self-link" href="#gcp" aria-label="Heading self-link"></a></h4>
<p>Cloud setup instructions can be found <a href="/docs/scenarios/cloud_setup/#gcp">here</a>. Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/gcp_node_scenarios.yml">here</a>.</p>
<h4 id="openstack">Openstack<a class="td-heading-self-link" href="#openstack" aria-label="Heading self-link"></a></h4>
<p>How to set up Openstack cli to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#openstack">here</a>.</p>
<p>The supported node level chaos scenarios on an OPENSTACK cloud are <code>node_stop_start_scenario</code>, <code>stop_start_kubelet_scenario</code> and <code>node_reboot_scenario</code>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For <code>stop_start_helper_node_scenario</code>,  visit <a href="https://github.com/redhat-cop/ocp4-helpernode">here</a> to learn more about the helper node and its usage.

</div>

<p>To execute the scenario, ensure the value for <code>ssh_private_key</code> in the node scenarios config file is set with the correct private key file path for ssh connection to the helper node. Ensure passwordless ssh is configured on the host running Kraken and the helper node to avoid connection errors.</p>
<h4 id="azure">Azure<a class="td-heading-self-link" href="#azure" aria-label="Heading self-link"></a></h4>
<p>Cloud setup instructions can be found <a href="/docs/scenarios/cloud_setup/#azure">here</a>. Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/azure_node_scenarios.yml">here</a>.</p>
<h4 id="alibaba">Alibaba<a class="td-heading-self-link" href="#alibaba" aria-label="Heading self-link"></a></h4>
<p>How to set up Alibaba cli to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#alibaba">here</a>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    There is no &ldquo;terminating&rdquo; idea in Alibaba, so any scenario with terminating will &ldquo;release&rdquo; the node
. Releasing a node is 2 steps, stopping the node and then releasing it.

</div>

<h4 id="vmware">VMware<a class="td-heading-self-link" href="#vmware" aria-label="Heading self-link"></a></h4>
<p>How to set up VMware vSphere to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#vmware">here</a></p>
<p>This cloud type uses a different configuration style, see actions below and <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/vmware_node_scenarios.yml">example config file</a></p>
<ul>
<li>vmware-node-terminate</li>
<li>vmware-node-reboot</li>
<li>vmware-node-stop</li>
<li>vmware-node-start</li>
</ul>
<h4 id="ibmcloud">IBMCloud<a class="td-heading-self-link" href="#ibmcloud" aria-label="Heading self-link"></a></h4>
<p>How to set up IBMCloud to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#ibmcloud">here</a></p>
<p>This cloud type uses a different configuration style, see actions below and <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/ibmcloud_node_scenarios.yml">example config file</a></p>
<ul>
<li>ibmcloud-node-terminate</li>
<li>ibmcloud-node-reboot</li>
<li>ibmcloud-node-stop</li>
<li>ibmcloud-node-start</li>
</ul>
<h4 id="general">General<a class="td-heading-self-link" href="#general" aria-label="Heading self-link"></a></h4>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The <code>node_crash_scenario</code> and <code>stop_kubelet_scenario</code> scenario is supported independent of the cloud platform.

</div>

<p>Use &lsquo;generic&rsquo; or do not add the &lsquo;cloud_type&rsquo; key to your scenario if your cluster is not set up using one of the current supported cloud types.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-41b7887a58c35ebdc959d9678afaee4b">9.2 - Node Scenarios using Krkn-Hub</h1>
    
	<p>This scenario disrupts the node(s) matching the label on a Kubernetes/OpenShift cluster. Actions/disruptions supported are listed <a href="/docs/scenarios/node-scenarios/">here</a></p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="all_scenarios_env.md">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACTION</td>
<td>Action can be one of the <a href="https://github.com/krkn-chaos/krkn/blob/master/docs/node_scenarios.md">following</a></td>
<td>node_stop_start_scenario for aws and vmware-node-reboot for vmware, ibmcloud-node-reboot for ibmcloud</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Node label to target</td>
<td>node-role.kubernetes.io/worker</td>
</tr>
<tr>
<td>NODE_NAME</td>
<td>Node name to inject faults in case of targeting a specific node; Can set multiple node names separated by a comma</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Targeted instance count matching the label selector</td>
<td>1</td>
</tr>
<tr>
<td>RUNS</td>
<td>Iterations to perform action on a single node</td>
<td>1</td>
</tr>
<tr>
<td>CLOUD_TYPE</td>
<td>Cloud platform on top of which cluster is running, supported platforms - aws, vmware, ibmcloud, bm</td>
<td>aws</td>
</tr>
<tr>
<td>TIMEOUT</td>
<td>Duration to wait for completion of node scenario injection</td>
<td>180</td>
</tr>
<tr>
<td>DURATION</td>
<td>Duration to stop the node before running the start action - not supported for vmware and ibm cloud type</td>
<td>120</td>
</tr>
<tr>
<td>VERIFY_SESSION</td>
<td>Only needed for vmware - Set to True if you want to verify the vSphere client session using certificates</td>
<td>False</td>
</tr>
<tr>
<td>SKIP_OPENSHIFT_CHECKS</td>
<td>Only needed for vmware - Set to True if you don&rsquo;t want to wait for the status of the nodes to change on OpenShift before passing the scenario</td>
<td>False</td>
</tr>
<tr>
<td>BMC_USER</td>
<td>Only needed for Baremetal ( bm ) - IPMI/bmc username</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>BMC_PASSWORD</td>
<td>Only needed for Baremetal ( bm ) - IPMI/bmc password</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>BMC_ADDR</td>
<td>Only needed for Baremetal ( bm ) - IPMI/bmc username</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios 
</span></span></code></pre></div><p>The following environment variables need to be set for the scenarios that requires intereacting with the cloud platform API to perform the actions:</p>
<p>Amazon Web Services</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_ACCESS_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_DEFAULT_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>VMware Vsphere</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">VSPHERE_IP</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vSphere_client_IP_address&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">VSPHERE_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vSphere_client_username&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">VSPHERE_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vSphere_client_password&gt;
</span></span></code></pre></div><p>Ibmcloud</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">IBMC_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://&lt;region&gt;.iaas.cloud.ibm.com/v1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">IBMC_APIKEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;ibmcloud_api_key&gt;
</span></span></code></pre></div><p>Baremetal</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">BMC_USER</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;bmc/IPMI user&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">BMC_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;bmc/IPMI password&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">BMC_ADDR</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;bmc address&gt;
</span></span></code></pre></div><p>Google Cloud Platform</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Azure</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AZURE_TENANT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AZURE_CLIENT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AZURE_CLIENT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>OpenStack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/ANZY7HhPdWTNaWt4xMFanF6Q5">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-affd85910adbdf9ad08c6ed992c6bb14">10 - Pod Network Scenarios</h1>
    
	<h3 id="pod-outage">Pod outage<a class="td-heading-self-link" href="#pod-outage" aria-label="Heading self-link"></a></h3>
<p>Scenario to block the traffic ( Ingress/Egress ) of a pod matching the labels for the specified duration of time to understand the behavior of the service/other services which depend on it during downtime. This helps with planning the requirements accordingly, be it improving the timeouts or tweaking the alerts etc.
With the current network policies, it is not possible to explicitly block ports which are enabled by allowed network policy rule. This chaos scenario addresses this issue by using OVS flow rules to block ports related to the pod. It supports OpenShiftSDN and OVNKubernetes based networks.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3113de3ae94ded0c459e52ecda391a77">10.1 - Pod Scenarios using Krkn</h1>
    
	<h5 id="sample-scenario-config-using-a-plugin">Sample scenario config (using a plugin)<a class="td-heading-self-link" href="#sample-scenario-config-using-a-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod_network_outage</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-console  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Required - Namespace of the pod to which filter need to be applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">direction</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># Optioinal - List of directions to apply filters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">ingress                 </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Blocks ingress traffic, Default both egress and ingress</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ingress_ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#8f5902;font-style:italic"># Optional - List of ports to block traffic on</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#0000cf;font-weight:bold">8443</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># Blocks 8443, Default [], i.e. all ports.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;component=ui&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Blocks access to openshift console</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="pod-network-shaping">Pod Network shaping<a class="td-heading-self-link" href="#pod-network-shaping" aria-label="Heading self-link"></a></h3>
<p>Scenario to introduce network latency, packet loss, and bandwidth restriction in the Pod&rsquo;s network interface. The purpose of this scenario is to observe faults caused by random variations in the network.</p>
<h5 id="sample-scenario-config-for-egress-traffic-shaping-using-plugin">Sample scenario config for egress traffic shaping (using plugin)<a class="td-heading-self-link" href="#sample-scenario-config-for-egress-traffic-shaping-using-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod_egress_shaping</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-console  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Required - Namespace of the pod to which filter need to be applied.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;component=ui&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Applies traffic shaping to access openshift console.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">network_params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Add 500ms latency to egress traffic from the pod.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="sample-scenario-config-for-ingress-traffic-shaping-using-plugin">Sample scenario config for ingress traffic shaping (using plugin)<a class="td-heading-self-link" href="#sample-scenario-config-for-ingress-traffic-shaping-using-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod_ingress_shaping</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-console  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Required - Namespace of the pod to which filter need to be applied.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;component=ui&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Applies traffic shaping to access openshift console.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">network_params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Add 500ms latency to egress traffic from the pod.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="steps">Steps<a class="td-heading-self-link" href="#steps" aria-label="Heading self-link"></a></h5>
<ul>
<li>Pick the pods to introduce the network anomaly either from label_selector or pod_name.</li>
<li>Identify the pod interface name on the node.</li>
<li>Set traffic shaping config on pod&rsquo;s interface using tc and netem.</li>
<li>Wait for the duration time.</li>
<li>Remove traffic shaping config on pod&rsquo;s interface.</li>
<li>Remove the job that spawned the pod.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5edf70896392385f5e879c8c6af1559c">10.2 - Pod Network Chaos Scenarios using Krkn-hub</h1>
    
	<p>This scenario runs network chaos at the pod level on a Kubernetes/OpenShift cluster.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code>
See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>NAMESPACE</td>
<td>Required - Namespace of the pod to which filter need to be applied</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the pod(s) to target</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>POD_NAME</td>
<td>When label_selector is not specified, pod matching the name will be selected for the chaos scenario</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Number of pods to perform action/select that match the label selector</td>
<td>1</td>
</tr>
<tr>
<td>TRAFFIC_TYPE</td>
<td>List of directions to apply filters - egress/ingress ( needs to be a list )</td>
<td>[ingress, egress]</td>
</tr>
<tr>
<td>INGRESS_PORTS</td>
<td>Ingress ports to block ( needs to be a list )</td>
<td>[] i.e all ports</td>
</tr>
<tr>
<td>EGRESS_PORTS</td>
<td>Egress ports to block ( needs to be a list )</td>
<td>[] i.e all ports</td>
</tr>
<tr>
<td>WAIT_DURATION</td>
<td>Ensure that it is at least about twice of test_duration</td>
<td>300</td>
</tr>
<tr>
<td>TEST_DURATION</td>
<td>Duration of the test run</td>
<td>120</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-abccb6686f7f738ead88a179903bd631">11 - Pod Scenarios</h1>
    
	<p>Krkn recently replaced PowerfulSeal with its own internal pod scenarios using a plugin system. This scenario disrupts the pods matching the label in the specified namespace on a Kubernetes/OpenShift cluster.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-95b830de59fc16f5bfb39617cfcd5402">11.1 - Pod Scenarios using Krkn</h1>
    
	<h4 id="example-config">Example Config<a class="td-heading-self-link" href="#example-config" aria-label="Heading self-link"></a></h4>
<p>The following are the components of Kubernetes for which a basic chaos scenario config exists today.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">plugin_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">path/to/scenario.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You can then create the scenario file with the following contents:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># yaml-language-server: $schema=../plugin.schema.json</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kill-pods</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace_pattern</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">^kube-system$</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">k8s-app=kube-scheduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">krkn_pod_recovery_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span></code></pre></div><p>Please adjust the schema reference to point to the <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/plugin.schema.json">schema file</a>. This file will give you code completion and documentation for the available options in your IDE.</p>
<h4 id="pod-chaos-scenarios">Pod Chaos Scenarios<a class="td-heading-self-link" href="#pod-chaos-scenarios" aria-label="Heading self-link"></a></h4>
<p>The following are the components of Kubernetes/OpenShift for which a basic chaos scenario config exists today.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Working</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/kube/pod.yml">Basic pod scenario</a></td>
<td>Kill a pod.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/etcd.yml">Etcd</a></td>
<td>Kills a single/multiple etcd replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/openshift-kube-apiserver.yml">Kube ApiServer</a></td>
<td>Kills a single/multiple kube-apiserver replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/openshift-apiserver.yml">ApiServer</a></td>
<td>Kills a single/multiple apiserver replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/prometheus.yml">Prometheus</a></td>
<td>Kills a single/multiple prometheus replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/regex_openshift_pod_kill.yml">OpenShift System Pods</a></td>
<td>Kills random pods running in the OpenShift system namespaces.</td>
<td>:heavy_check_mark:</td>
</tr>
</tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dd864f90e71659610098eefe5ef8e784">11.2 - Pod Scenarios using Krkn-hub</h1>
    
	<p>This scenario disrupts the pods matching the label in the specified namespace on a Kubernetes/OpenShift cluster.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>NAMESPACE</td>
<td>Targeted namespace in the cluster ( supports regex )</td>
<td>openshift-.*</td>
</tr>
<tr>
<td>POD_LABEL</td>
<td>Label of the pod(s) to target</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>NAME_PATTERN</td>
<td>Regex pattern to match the pods in NAMESPACE  when POD_LABEL is not specified</td>
<td>.*</td>
</tr>
<tr>
<td>DISRUPTION_COUNT</td>
<td>Number of pods to disrupt</td>
<td>1</td>
</tr>
<tr>
<td>KILL_TIMEOUT</td>
<td>Timeout to wait for the target pod(s) to be removed in seconds</td>
<td>180</td>
</tr>
<tr>
<td>EXPECTED_RECOVERY_TIME</td>
<td>Fails if the pod disrupted do not recover within the timeout set</td>
<td>120</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Set NAMESPACE environment variable to <code>openshift-.*</code> to pick and disrupt pods randomly in openshift system namespaces, the DAEMON_MODE can also be enabled to disrupt the pods every x seconds in the background to check the reliability.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452351?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ce8b54635e230b2999da190ebd1e41be">12 - Power Outage Scenarios</h1>
    
	<p>This scenario shuts down Kubernetes/OpenShift cluster for the specified duration to simulate power outages, brings it back online and checks if it&rsquo;s healthy.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-86b7bbcde807ac105b3ed9bf4854bc3d">12.1 - Power Outage Scenario using Krkn</h1>
    
	<p>Power Outage/ Cluster shut down scenario can be injected by placing the shut_down config file under cluster_shut_down_scenario option in the kraken config. Refer to <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/cluster_shut_down_scenario.yml">cluster_shut_down_scenario</a> config file.</p>
<p>Refer to <a href="/docs/scenarios/cloud_setup/">cloud setup</a> to configure your cli properly for the cloud provider of the cluster you want to shut down.</p>
<p>Current accepted cloud types:</p>
<ul>
<li><a href="/docs/scenarios/cloud_setup/#azure">Azure</a></li>
<li><a href="/docs/scenarios/cloud_setup/#gcp">GCP</a></li>
<li><a href="/docs/scenarios/cloud_setup/#aws">AWS</a></li>
<li><a href="/docs/scenarios/cloud_setup/#openstack">Openstack</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">cluster_shut_down_scenario</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># Scenario to stop all the nodes for specified duration and restart the nodes.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">runs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">                                            </span><span style="color:#8f5902;font-style:italic"># Number of times to execute the cluster_shut_down scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">shut_down_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># Duration in seconds to shut down the cluster.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cloud_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws                                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Cloud type on which Kubernetes/OpenShift runs.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f78409366ed557faa404a782e364505b">12.2 - Power Outage Scenario using Krkn-Hub</h1>
    
	<p>This scenario shuts down Kubernetes/OpenShift cluster for the specified duration to simulate power outages, brings it back online and checks if it&rsquo;s healthy. More information can be found <a href="/docs/scenarios/power-outage-scenarios/">here</a></p>
<p>Right now power outage and cluster shutdown are one in the same. We originally created this scenario to stop all the nodes and then start them back up how a customer would shut their cluster down.</p>
<p>In a real life chaos scenario though, we figured this scenario was close to if the power went out on the aws side so all of our ec2 nodes would be stopped/powered off.
We tried to look at if aws cli had a way to forcefully poweroff the nodes (not gracefully) and they don&rsquo;t currently support so this scenario is as close as we can get to &ldquo;pulling the plug&rdquo;</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:power-outages
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:power-outages
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:power-outages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>SHUTDOWN_DURATION</td>
<td>Duration in seconds to shut down the cluster</td>
<td>1200</td>
</tr>
<tr>
<td>CLOUD_TYPE</td>
<td>Cloud platform on top of which cluster is running, <a href="https://github.com/krkn-chaos/krkn/blob/master/docs/node_scenarios.md">supported cloud platforms</a></td>
<td>aws</td>
</tr>
<tr>
<td>TIMEOUT</td>
<td>Time in seconds to wait for each node to be stopped or running after the cluster comes back</td>
<td>600</td>
</tr>
</tbody>
</table>
<p>The following environment variables need to be set for the scenarios that requires intereacting with the cloud platform API to perform the actions:</p>
<p>Amazon Web Services</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_ACCESS_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_DEFAULT_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>Google Cloud Platform</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Azure</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>OpenStack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Baremetal</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/r0zLbh70XK7gnc4s5v0ZzSXGo">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-894d789e8e0ad80e01add4fc659d4230">13 - PVC Scenario</h1>
    
	<p>Scenario to fill up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it. The purpose of this scenario is to fill up a volume to understand faults caused by the application using this volume.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-042a0835bd60597669c3f484912f9e1e">13.1 - PVC Scenario using Krkn</h1>
    
	<h5 id="sample-scenario-config">Sample scenario config<a class="td-heading-self-link" href="#sample-scenario-config" aria-label="Heading self-link"></a></h5>
<pre tabindex="0"><code>pvc_scenario:
  pvc_name: &lt;pvc_name&gt;          # Name of the target PVC.
  pod_name: &lt;pod_name&gt;          # Name of the pod where the PVC is mounted. It will be ignored if the pvc_name is defined.
  namespace: &lt;namespace_name&gt;   # Namespace where the PVC is.
  fill_percentage: 50           # Target percentage to fill up the cluster. Value must be higher than current percentage. Valid values are between 0 and 99.
  duration: 60                  # Duration in seconds for the fault.
</code></pre><h5 id="steps">Steps<a class="td-heading-self-link" href="#steps" aria-label="Heading self-link"></a></h5>
<ul>
<li>Get the pod name where the PVC is mounted.</li>
<li>Get the volume name mounted in the container pod.</li>
<li>Get the container name where the PVC is mounted.</li>
<li>Get the mount path where the PVC is mounted in the pod.</li>
<li>Get the PVC capacity and current used capacity.</li>
<li>Calculate file size to fill the PVC to the target fill_percentage.</li>
<li>Connect to the pod.</li>
<li>Create a temp file <code>kraken.tmp</code> with random data on the mount path:
<ul>
<li><code>dd bs=1024 count=$file_size &lt;/dev/urandom &gt; /mount_path/kraken.tmp</code></li>
</ul>
</li>
<li>Wait for the duration time.</li>
<li>Remove the temp file created:
<ul>
<li><code>rm kraken.tmp</code></li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a07e0c044e3bf878a9d652efab248a8a">13.2 - PVC Scenario using Krkn-Hub</h1>
    
	<p>This scenario fills up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it. The purpose of this scenario is to fill up a volume to understand faults cause by the application using this volume. For more information refer the following <a href="/docs/scenarios/pvc-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>If both <code>PVC_NAME</code> and <code>POD_NAME</code> are defined, <code>POD_NAME</code> value will be overridden from the <code>Mounted By:</code> value on PVC definition.</p>
<p>See list of variables that apply to all scenarios <a href="all_scenarios_env.md">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>PVC_NAME</td>
<td>Targeted PersistentVolumeClaim in the cluster (if null, POD_NAME is required)</td>
<td></td>
</tr>
<tr>
<td>POD_NAME</td>
<td>Targeted pod in the cluster (if null, PVC_NAME is required)</td>
<td></td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Targeted namespace in the cluster (required)</td>
<td></td>
</tr>
<tr>
<td>FILL_PERCENTAGE</td>
<td>Targeted percentage to be filled up in the PVC</td>
<td>50</td>
</tr>
<tr>
<td>DURATION</td>
<td>Duration in seconds with the PVC filled up</td>
<td>60</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Set NAMESPACE environment variable to <code>openshift-.*</code> to pick and disrupt pods randomly in openshift system namespaces, the DAEMON_MODE can also be enabled to disrupt the pods every x seconds in the background to check the reliability.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-71b2337dd184e179e48995c1b262ac17">14 - Service Disruption Scenarios</h1>
    
	<p>Using this type of scenario configuration one is able to delete crucial objects in a specific namespace, or a namespace matching a certain regex string.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c229626aef295356c4fa6fb05ffe42db">14.1 - Service Disruption Scenarios using Krkn</h1>
    
	<h2 id="configuration-options">Configuration Options:<a class="td-heading-self-link" href="#configuration-options" aria-label="Heading self-link"></a></h2>
<p><strong>namespace:</strong> Specific namespace or regex style namespace of what you want to delete. Gets all namespaces if not specified; set to &quot;&quot; if you want to use the label_selector field.</p>
<p>Set to &lsquo;^.*$&rsquo; and label_selector to &quot;&quot; to randomly select any namespace in your cluster.</p>
<p><strong>label_selector:</strong> Label on the namespace you want to delete. Set to &quot;&quot; if you are using the namespace variable.</p>
<p><strong>delete_count:</strong> Number of namespaces to kill in each run. Based on matching namespace and label specified, default is 1.</p>
<p><strong>runs:</strong> Number of runs/iterations to kill namespaces, default is 1.</p>
<p><strong>sleep:</strong> Number of seconds to wait between each iteration/count of killing namespaces. Defaults to 10 seconds if not set</p>
<p>Refer to <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/regex_namespace.yaml">namespace_scenarios_example</a> config file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;^.*$&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">runs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;^.*ingress.*$&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">runs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">sleep</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="steps">Steps<a class="td-heading-self-link" href="#steps" aria-label="Heading self-link"></a></h3>
<p>This scenario will select a namespace (or multiple) dependent on the configuration and will kill all of the below object types in that namespace and will wait for them to be Running in the post action</p>
<ol>
<li>Services</li>
<li>Daemonsets</li>
<li>Statefulsets</li>
<li>Replicasets</li>
<li>Deployments</li>
</ol>
<h4 id="post-action">Post Action<a class="td-heading-self-link" href="#post-action" aria-label="Heading self-link"></a></h4>
<p>We do a post chaos check to wait and verify the specific objects in each namespace are Ready</p>
<p>Here there are two options:</p>
<ol>
<li>Pass a custom script in the main config scenario list that will run before the chaos and verify the output matches post chaos scenario.</li>
</ol>
<p>See <a href="https://github.com/cloud-bulldozer/kraken/tree/master/scenarios/post_action_namespace.py">scenarios/post_action_namespace.py</a> for an example</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">     </span>- - <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/regex_namespace.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/post_action_namespace.py</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ol>
<li>Allow kraken to wait and check all killed objects in the namespaces become &lsquo;Running&rsquo; again. Kraken keeps a list of the specific
objects in namespaces that were killed to verify all that were affected recover properly.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">wait_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;seconds to wait for namespace to recover&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-afd27124a9063adebb9970a5b2f94b01">14.2 - Service Disruption Scenario using Krkn-Hub</h1>
    
	<p>This scenario deletes main objects within a namespace in your Kubernetes/OpenShift cluster. More information can be found <a href="/docs/scenarios/service-disruption-scenarios/">here</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the namespace to target. Set this parameter only if NAMESPACE is not set</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Name of the namespace you want to target. Set this parameter only if LABEL_SELECTOR is not set</td>
<td>&ldquo;openshift-etcd&rdquo;</td>
</tr>
<tr>
<td>SLEEP</td>
<td>Number of seconds to wait before polling to see if namespace exists again</td>
<td>15</td>
</tr>
<tr>
<td>DELETE_COUNT</td>
<td>Number of namespaces to kill in each run, based on matching namespace and label specified</td>
<td>1</td>
</tr>
<tr>
<td>RUNS</td>
<td>Number of runs to execute the action</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/kKPSI0D7upV9HQWH5jnroTaKb">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ce393854ff3da73a278e77f5f3f45ac4">15 - Service Hijacking Scenario</h1>
    
	<p>Service Hijacking Scenarios aim to simulate fake HTTP responses from a workload targeted by a Service already deployed in the cluster. This scenario is executed by deploying a custom-made web service and modifying the target Service selector to direct traffic to this web service for a specified duration.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-0326ec69aa2cf1ccbeb0b57479a77dba">15.1 - Service Hijacking Scenarios using Krkn</h1>
    
	<p>The web service&rsquo;s source code is available <a href="https://github.com/krkn-chaos/krkn-service-hijacking">here</a>.
It employs a time-based test plan from the scenario configuration file, which specifies the behavior of resources during the chaos scenario as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">service_target_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">http-web-svc</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The port of the service to be hijacked (can be named or numeric, based on the workload and service configuration).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">service_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx-service</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The name of the service that will be hijacked.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">service_namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The namespace where the target service is located.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">quay.io/krkn-chaos/krkn-service-hijacking:v0.1.3</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Image of the krkn web service to be deployed to receive traffic.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">chaos_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Total duration of the chaos scenario in seconds.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">plan</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">resource</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/list/index.php&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Specifies the resource or path to respond to in the scenario. For paths, both the path and query parameters are captured but ignored. For resources, only query parameters are captured.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#8f5902;font-style:italic"># A time-based plan consisting of steps can be defined for each resource.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">GET:                      # One or more HTTP methods can be specified for each step. Note</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Non-standard methods are supported for fully custom web services (e.g., using NONEXISTENT instead of POST).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Duration in seconds for this step before moving to the next one, if defined. Otherwise, this step will continue until the chaos scenario ends.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">500</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#8f5902;font-style:italic"># HTTP status code to be returned in this step.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># MIME type of the response for this step.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">|           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The response payload for this step.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>{<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#4e9a06">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;internal server error&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">201</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            {
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">              &#34;status&#34;:&#34;resource created&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            }</span><span style="color:#f8f8f8;text-decoration:underline">            
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">POST</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">401</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            {
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">               &#34;status&#34;: &#34;unauthorized&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            }</span><span style="color:#f8f8f8;text-decoration:underline">            
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">404</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;text/plain&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;not found&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The scenario will focus on the <code>service_name</code> within the <code>service_namespace</code>,
substituting the selector with a randomly generated one, which is added as a label in the mock service manifest.
This allows multiple scenarios to be executed in the same namespace, each targeting different services without
causing conflicts.</p>
<p>The newly deployed mock web service will expose a <code>service_target_port</code>,
which can be either a named or numeric port based on the service configuration.
This ensures that the Service correctly routes HTTP traffic to the mock web service during the chaos run.</p>
<p>Each step will last for <code>duration</code> seconds from the deployment of the mock web service in the cluster.
For each HTTP resource, defined as a top-level YAML property of the plan
(it could be a specific resource, e.g., /list/index.php, or a path-based resource typical in MVC frameworks),
one or more HTTP request methods can be specified. Both standard and custom request methods are supported.</p>
<p>During this time frame, the web service will respond with:</p>
<ul>
<li><code>status</code>: The <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-6">HTTP status code</a> (can be standard or custom).</li>
<li><code>mime_type</code>: The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME type</a> (can be standard or custom).</li>
<li><code>payload</code>: The response body to be returned to the client.</li>
</ul>
<p>At the end of the step <code>duration</code>, the web service will proceed to the next step (if available) until
the global <code>chaos_duration</code> concludes. At this point, the original service will be restored,
and the custom web service and its resources will be undeployed.</p>
<p><strong>NOTE</strong>: Some clients (e.g., cURL, jQuery) may optimize queries using lightweight methods (like HEAD or OPTIONS)
to probe API behavior. If these methods are not defined in the test plan, the web service may respond with
a <code>405</code> or <code>404</code> status code. If you encounter unexpected behavior, consider this use case.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8645cf3ca8634c69a0c8ad7ac90fbe06">15.2 - Service Hijacking Scenario using Krkn-Hub</h1>
    
	<p>This scenario reroutes traffic intended for a target service to a custom web service that is automatically deployed by Krkn.
This web service responds with user-defined HTTP statuses, MIME types, and bodies.
For more details, please refer to the following <a href="/docs/scenarios/service-hijacking-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>Unlike other krkn-hub scenarios, this one requires a specific configuration due to its unique structure.
You must set up the scenario in a local file following the <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/kube/service_hijacking.yaml">scenario syntax</a>,
and then pass this file&rsquo;s base64-encoded content to the container via the SCENARIO_BASE64 variable.</p>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>.
Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code>
environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run  --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>              -e <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>              -v &lt;path_to_kubeconfig&gt;:/home/krkn/.kube/config:Z quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span><span style="display:flex;"><span>              
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                       --net<span style="color:#ce5c00;font-weight:bold">=</span>host <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                       -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                       -d quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; -e <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                     --net<span style="color:#ce5c00;font-weight:bold">=</span>host <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                     -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                     -d quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    ecause the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:
example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="all_scenarios_env.md">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SCENARIO_BASE64</td>
<td>Base64 encoded service-hijacking scenario file. Note that the <strong>-w0</strong> option in the command substitution <code>SCENARIO_BASE64=&quot;$(base64 -w0 &lt;scenario_file&gt;)&quot;</code> is <strong>mandatory</strong> in order to remove line breaks from the base64 command output</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run -e <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             --net<span style="color:#ce5c00;font-weight:bold">=</span>host <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -d quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a4fbbfbd8b11ce2dd79180e169a6c09c">16 - Time Scenarios</h1>
    
	<p>Using this type of scenario configuration, one is able to change the time and/or date of the system for pods or nodes.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4e099f299e4e2e9c590fc5a8f3dbdb1f">16.1 - Time Scenarios using Krkn</h1>
    
	<h3 id="configuration-options">Configuration Options:<a class="td-heading-self-link" href="#configuration-options" aria-label="Heading self-link"></a></h3>
<p><strong>action:</strong> skew_time or skew_date.</p>
<p><strong>object_type:</strong> pod or node.</p>
<p><strong>namespace:</strong> namespace of the pods you want to skew. Needs to be set if setting a specific pod name.</p>
<p><strong>label_selector:</strong> Label on the nodes or pods you want to skew.</p>
<p><strong>container_name:</strong> Container name in pod you want to reset time on. If left blank it will randomly select one.</p>
<p><strong>object_name:</strong> List of the names of pods or nodes you want to skew.</p>
<p>Refer to <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/time_scenarios_example.yml">time_scenarios_example</a> config file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">time_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">action</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">skew_time</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">object_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">object_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">apiserver-868595fcbb-6qnsc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">apiserver-868595fcbb-mb9j5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">container_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">action</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">skew_date</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">object_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/worker</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f029f0161de9931fff733ccc2fde58e5">16.2 - Time Skew Scenarios using Krkn-Hub</h1>
    
	<p>This scenario skews the date and time of the nodes and pods matching the label on a Kubernetes/OpenShift cluster. More information can be found <a href="/docs/scenarios/time-scenarios/">here</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:time-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:time-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:time-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>OBJECT_TYPE</td>
<td>Object to target. Supported options: pod, node</td>
<td>pod</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the container(s) or nodes to target</td>
<td>k8s-app=etcd</td>
</tr>
<tr>
<td>ACTION</td>
<td>Action to run. Supported actions: skew_time, skew_date</td>
<td>skew_date</td>
</tr>
<tr>
<td>OBJECT_NAME</td>
<td>List of the names of pods or nodes you want to skew ( optional parameter )</td>
<td>[]</td>
</tr>
<tr>
<td>CONTAINER_NAME</td>
<td>Container in the specified pod to target in case the pod has multiple containers running. Random container is picked if empty</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace of the pods you want to skew, need to be set only if setting a specific pod name</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/zMBAdzHE40oPXkFVIz0exEoOX">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-de67113eb2d27bfedac46c07b5c4db22">17 - Zone Outage Scenarios</h1>
    
	<p>Scenario to create outage in a targeted zone in the public cloud to understand the impact on both Kubernetes/OpenShift control plane as well as applications running on the worker nodes in that zone. It tweaks the network acl of the zone to simulate the failure and that in turn will stop both ingress and egress traffic from all the nodes in a particular zone for the specified duration and reverts it back to the previous state.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a98bdfa4b92598e3eeed675e2a73ea11">17.1 - Zone Outage Scenarios using Krkn</h1>
    
	<p>Zone outage can be injected by placing the zone_outage config file under zone_outages option in the <a href="https://github.com/redhat-chaos/krkn/blob/main/config/config.yaml">kraken config</a>. Refer to <a href="https://github.com/redhat-chaos/krkn/blob/main/scenarios/zone_outage.yaml">zone_outage_scenario</a> config file for the parameters that need to be defined.</p>
<p>Refer to <a href="/docs/scenarios/cloud_setup/">cloud setup</a> to configure your cli properly for the cloud provider of the cluster you want to shut down.</p>
<h5 id="current-accepted-cloud-types">Current accepted cloud types:<a class="td-heading-self-link" href="#current-accepted-cloud-types" aria-label="Heading self-link"></a></h5>
<ul>
<li><a href="/docs/scenarios/cloud_setup/#aws">AWS</a></li>
</ul>
<h5 id="sample-scenario-config">Sample scenario config<a class="td-heading-self-link" href="#sample-scenario-config" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">zone_outage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                         </span><span style="color:#8f5902;font-style:italic"># Scenario to create an outage of a zone by tweaking network ACL.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cloud_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws                                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Cloud type on which Kubernetes/OpenShift runs. aws is the only platform supported currently for this scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">600</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># Duration in seconds after which the zone will be back online.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vpc_id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                            </span><span style="color:#8f5902;font-style:italic"># Cluster virtual private network to target.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">subnet_id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">subnet1, subnet2]                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># List of subnet-id&#39;s to deny both ingress and egress traffic.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    vpc_id and subnet_id can be obtained from the cloud web console by selecting one of the instances in the targeted zone ( us-west-2a for example ).

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Multiple zones will experience downtime in case of targeting multiple subnets which might have an impact on the cluster health especially if the zones have control plane components deployed.

</div>

<h5 id="debugging-steps-in-case-of-failures">Debugging steps in case of failures<a class="td-heading-self-link" href="#debugging-steps-in-case-of-failures" aria-label="Heading self-link"></a></h5>
<p>In case of failures during the steps which revert back the network acl to allow traffic and bring back the cluster nodes in the zone, the nodes in the particular zone will be in <code>NotReady</code> condition. Here is how to fix it:</p>
<ul>
<li>OpenShift by default deploys the nodes in different zones for fault tolerance, for example us-west-2a, us-west-2b, us-west-2c. The cluster is associated with a virtual private network and each zone has its own subnet with a network acl which defines the ingress and egress traffic rules at the zone level unlike security groups which are at an instance level.</li>
<li>From the cloud web console, select one of the instances in the zone which is down and go to the subnet_id specified in the config.</li>
<li>Look at the network acl associated with the subnet and you will see both ingress and egress traffic being denied which is expected as Kraken deliberately injects it.</li>
<li>Kraken just switches the network acl while still keeping the original or default network acl around, switching to the default network acl from the drop-down menu will get back the nodes in the targeted zone into Ready state.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ac460820001befdfa88a92bc5f36f753">17.2 - Zone Outage Scenarios using Krkn-Hub</h1>
    
	<p>This scenario disrupts a targeted zone in the public cloud by blocking egress and ingress traffic to understand the impact on both Kubernetes/OpenShift platforms control plane as well as applications running on the worker nodes in that zone. More information is documented <a href="/docs/scenarios/zone-outage-scenarios/">here</a></p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:zone-outages
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:zone-outages
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:zone-outages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLOUD_TYPE</td>
<td>Cloud platform on top of which cluster is running, <a href="/docs/scenarios/cloud_setup/">supported cloud platforms</a></td>
<td>aws</td>
</tr>
<tr>
<td>DURATION</td>
<td>Duration in seconds after which the zone will be back online</td>
<td>600</td>
</tr>
<tr>
<td>VPC_ID</td>
<td>cluster virtual private network to target ( REQUIRED )</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>SUBNET_ID</td>
<td>subnet-id to deny both ingress and egress traffic ( REQUIRED ). Format: [subenet1, subnet2]</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>The following environment variables need to be set for the scenarios that requires intereacting with the cloud platform API to perform the actions:</p>
<p>Amazon Web Services</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_ACCESS_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_DEFAULT_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>Google Cloud Platform</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Azure</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>OpenStack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Baremetal</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452672?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-31dc471e07bb163ac298937597cfdea2">18 - All Scenarios Variables</h1>
    
	<p>These variables are to be used for the top level configuration template that are shared by all the scenarios</p>
<p>See the description and default values below</p>
<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>CERBERUS_ENABLED</td>
<td>Set this to true if cerberus is running and monitoring the cluster</td>
<td>False</td>
</tr>
<tr>
<td>CERBERUS_URL</td>
<td>URL to poll for the go/no-go signal</td>
<td>http://0.0.0.0:8080</td>
</tr>
<tr>
<td>WAIT_DURATION</td>
<td>Duration in seconds to wait between each chaos scenario</td>
<td>60</td>
</tr>
<tr>
<td>ITERATIONS</td>
<td>Number of times to execute the scenarios</td>
<td>1</td>
</tr>
<tr>
<td>DAEMON_MODE</td>
<td>Iterations are set to infinity which means that the kraken will cause chaos forever</td>
<td>False</td>
</tr>
<tr>
<td>PUBLISH_KRAKEN_STATUS</td>
<td>If you want</td>
<td>True</td>
</tr>
<tr>
<td>SIGNAL_ADDRESS</td>
<td>Address to print kraken status to</td>
<td>0.0.0.0</td>
</tr>
<tr>
<td>PORT</td>
<td>Port to print kraken status to</td>
<td>8081</td>
</tr>
<tr>
<td>SIGNAL_STATE</td>
<td>Waits for the RUN signal when set to PAUSE before running the scenarios, refer <a href="https://github.com/redhat-chaos/krkn/blob/master/docs/signal.md">docs</a> for more details</td>
<td>RUN</td>
</tr>
<tr>
<td>DEPLOY_DASHBOARDS</td>
<td>Deploys mutable grafana loaded with dashboards visualizing performance metrics pulled from in-cluster prometheus. The dashboard will be exposed as a route.</td>
<td>False</td>
</tr>
<tr>
<td>CAPTURE_METRICS</td>
<td>Captures metrics as specified in the profile from in-cluster prometheus. Default metrics captures are listed <a href="https://github.com/redhat-chaos/krkn/blob/master/config/metrics-aggregated.yaml">here</a></td>
<td>False</td>
</tr>
<tr>
<td>ENABLE_ALERTS</td>
<td>Evaluates expressions from in-cluster prometheus and exits 0 or 1 based on the severity set. <a href="https://github.com/redhat-chaos/krkn/blob/master/config/alerts">Default profile</a>. More details can be found <a href="https://github.com/redhat-chaos/krkn#alerts">here</a></td>
<td>False</td>
</tr>
<tr>
<td>ALERTS_PATH</td>
<td>Path to the alerts file to use when ENABLE_ALERTS is set</td>
<td>config/alerts</td>
</tr>
<tr>
<td>CHECK_CRITICAL_ALERTS</td>
<td>When enabled will check prometheus for critical alerts firing post chaos</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_ENABLED</td>
<td>Enable/disables the telemetry collection feature</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_API_URL</td>
<td>telemetry service endpoint</td>
<td><a href="https://ulnmf9xv7j.execute-api.us-west-2.amazonaws.com/production">https://ulnmf9xv7j.execute-api.us-west-2.amazonaws.com/production</a></td>
</tr>
<tr>
<td>TELEMETRY_USERNAME</td>
<td>telemetry service username</td>
<td>redhat-chaos</td>
</tr>
<tr>
<td>TELEMETRY_PASSWORD</td>
<td></td>
<td>No default</td>
</tr>
<tr>
<td>TELEMETRY_PROMETHEUS_BACKUP</td>
<td>enables/disables prometheus data collection</td>
<td>True</td>
</tr>
<tr>
<td>TELEMTRY_FULL_PROMETHEUS_BACKUP</td>
<td>if is set to False only the /prometheus/wal folder will be downloaded</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_BACKUP_THREADS</td>
<td>number of telemetry download/upload threads</td>
<td>5</td>
</tr>
<tr>
<td>TELEMETRY_ARCHIVE_PATH</td>
<td>local path where the archive files will be temporarly stored</td>
<td>/tmp</td>
</tr>
<tr>
<td>TELEMETRY_MAX_RETRIES</td>
<td>maximum number of upload retries (if 0 will retry forever)</td>
<td>0</td>
</tr>
<tr>
<td>TELEMETRY_RUN_TAG</td>
<td>if set, this will be appended to the run folder in the bucket (useful to group the runs</td>
<td>chaos</td>
</tr>
<tr>
<td>TELEMETRY_GROUP</td>
<td>if set will archive the telemetry in the S3 bucket on a folder named after the value</td>
<td>default</td>
</tr>
<tr>
<td>TELEMETRY_ARCHIVE_SIZE</td>
<td>the size of the prometheus data archive size in KB. The lower the size of archive is</td>
<td>1000</td>
</tr>
<tr>
<td>TELEMETRY_LOGS_BACKUP</td>
<td>Logs backup to s3</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_FILTER_PATTER</td>
<td>Filter logs based on certain time stamp patterns</td>
<td>[&quot;(\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\.\d+).+&quot;,&ldquo;kinit (\d+/\d+/\d+\s\d{2}:\d{2}:\d{2})\s+&rdquo;,&quot;(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+Z).+&quot;]</td>
</tr>
<tr>
<td>TELEMETRY_CLI_PATH</td>
<td>OC Cli path, if not specified will be search in $PATH</td>
<td><em>blank</em></td>
</tr>
<tr>
<td>ELASTIC_SERVER</td>
<td>Be able to track telemtry data in elasticsearch, this is the url of the elasticsearch data storage</td>
<td><em>blank</em></td>
</tr>
<tr>
<td>ELASTIC_INDEX</td>
<td>Elastic search index pattern to post results to</td>
<td><em>blank</em></td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For setting the TELEMETRY_ARCHIVE_SIZE,the higher the number of archive files will be produced and uploaded (and processed by backup_thread simultaneously).For unstable/slow connection is better to keep this value low increasing the number of backup_threads, in this way, on upload failure, the retry will happen only on the failed chunk without affecting the whole upload.

</div>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-41ff6593888c87620d21a5a31c783466">19 - Supported Cloud Providers</h1>
    
	<ul>
<li><a href="/docs/scenarios/cloud_setup/#aws">AWS</a></li>
<li><a href="/docs/scenarios/cloud_setup/#gcp">GCP</a></li>
<li><a href="/docs/scenarios/cloud_setup/#openstack">Openstack</a></li>
<li><a href="/docs/scenarios/cloud_setup/#azure">Azure</a></li>
<li><a href="/docs/scenarios/cloud_setup/#alibaba">Alibaba</a></li>
<li><a href="/docs/scenarios/cloud_setup/#vmware">VMware</a></li>
<li><a href="/docs/scenarios/cloud_setup/#ibmcloud">IBMCloud</a></li>
</ul>
<h2 id="aws">AWS<a class="td-heading-self-link" href="#aws" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: For clusters with AWS make sure <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI</a> is installed and properly <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">configured</a> using an AWS account</p>
<h2 id="gcp">GCP<a class="td-heading-self-link" href="#gcp" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: For clusters with GCP make sure <a href="https://cloud.google.com/sdk/docs/install#linux">GCP CLI</a> is installed.</p>
<p>A google service account is required to give proper authentication to GCP for node actions. See <a href="https://cloud.google.com/docs/authentication/getting-started">here</a> for how to create a service account.</p>
<p><strong>NOTE</strong>: A user with &lsquo;resourcemanager.projects.setIamPolicy&rsquo; permission is required to grant project-level permissions to the service account.</p>
<p>After creating the service account you will need to enable the account using the following: <code>export GOOGLE_APPLICATION_CREDENTIALS=&quot;&lt;serviceaccount.json&gt;&quot;</code></p>
<h2 id="openstack">Openstack<a class="td-heading-self-link" href="#openstack" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: For clusters with Openstack Cloud, ensure to create and source the <a href="https://docs.openstack.org/newton/user-guide/common/cli-set-environment-variables-using-openstack-rc.html">OPENSTACK RC file</a> to set the OPENSTACK environment variables from the server where Kraken runs.</p>
<h2 id="azure">Azure<a class="td-heading-self-link" href="#azure" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: You will need to create a service principal and give it the correct access, see <a href="https://docs.openshift.com/container-platform/4.5/installing/installing_azure/installing-azure-account.html">here</a> for creating the service principal and setting the proper permissions.</p>
<p>To properly run the service principal requires “Azure Active Directory Graph/Application.ReadWrite.OwnedBy” api permission granted and “User Access Administrator”.</p>
<p>Before running you will need to set the following:</p>
<ol>
<li>
<p><code>export AZURE_SUBSCRIPTION_ID=&lt;subscription_id&gt;</code></p>
</li>
<li>
<p><code>export AZURE_TENANT_ID=&lt;tenant_id&gt;</code></p>
</li>
<li>
<p><code>export AZURE_CLIENT_SECRET=&lt;client secret&gt;</code></p>
</li>
<li>
<p><code>export AZURE_CLIENT_ID=&lt;client id&gt;</code></p>
</li>
</ol>
<h2 id="alibaba">Alibaba<a class="td-heading-self-link" href="#alibaba" aria-label="Heading self-link"></a></h2>
<p>See the <a href="https://www.alibabacloud.com/help/en/alibaba-cloud-cli/latest/installation-guide">Installation guide</a> to install alicloud cli.</p>
<ol>
<li>
<p><code>export ALIBABA_ID=&lt;access_key_id&gt;</code></p>
</li>
<li>
<p><code>export ALIBABA_SECRET=&lt;access key secret&gt;</code></p>
</li>
<li>
<p><code>export ALIBABA_REGION_ID=&lt;region id&gt;</code></p>
</li>
</ol>
<p>Refer to <a href="https://www.alibabacloud.com/help/en/elastic-compute-service/latest/regions-and-zones#concept-2459516">region and zone page</a> to get the region id for the region you are running on.</p>
<p>Set cloud_type to either alibaba or alicloud in your node scenario yaml file.</p>
<h2 id="vmware">VMware<a class="td-heading-self-link" href="#vmware" aria-label="Heading self-link"></a></h2>
<p>Set the following environment variables</p>
<ol>
<li>
<p><code>export VSPHERE_IP=&lt;vSphere_client_IP_address&gt;</code></p>
</li>
<li>
<p><code>export VSPHERE_USERNAME=&lt;vSphere_client_username&gt;</code></p>
</li>
<li>
<p><code>export VSPHERE_PASSWORD=&lt;vSphere_client_password&gt;</code></p>
</li>
</ol>
<p>These are the credentials that you would normally use to access the vSphere client.</p>
<h2 id="ibmcloud">IBMCloud<a class="td-heading-self-link" href="#ibmcloud" aria-label="Heading self-link"></a></h2>
<p>If no api key is set up with proper VPC resource permissions, use the following to create:</p>
<ul>
<li>Access group</li>
<li>Service id with the following access
<ul>
<li>With policy <strong>VPC Infrastructure Services</strong></li>
<li>Resources = All</li>
<li>Roles:
<ul>
<li>Editor</li>
<li>Administrator</li>
<li>Operator</li>
<li>Viewer</li>
</ul>
</li>
</ul>
</li>
<li>API Key</li>
</ul>
<p>Set the following environment variables</p>
<ol>
<li>
<p><code>export IBMC_URL=https://&lt;region&gt;.iaas.cloud.ibm.com/v1</code></p>
</li>
<li>
<p><code>export IBMC_APIKEY=&lt;ibmcloud_api_key&gt;</code></p>
</li>
</ol>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/krkn-chaos/" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://kubernetes.slack.com/archives/C05SFMHRWK1" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024
    <span class="td-footer__authors">The Krkn-Chaos authors</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
